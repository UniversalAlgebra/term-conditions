%% FILE: prod-cong.tex
%% AUTHORS: William DeMeo
%% DATE: 21 January 2017
%% COPYRIGHT: (C) 2017 William DeMeo

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                         BIBLIOGRAPHY FILE                                 %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The `filecontents` command will crete a file in the inputs directory called 
%% refs.bib containing the references in the document, in case this file does 
%% not exist already.
%% If you want to add a BibTeX entry, please don't add it directly to the
%% refs.bib file.  Instead, add it in this file between the
%% \begin{filecontents*}{refs.bib} and \end{filecontents*} lines
%% then delete the existing refs.bib file so it will be automatically generated 
%% again with your new entry the next time you run pdfaltex.
\begin{filecontents*}{inputs/refs2.bib}
@article{Bergman-DeMeo-2016,
  author    = {Clifford Bergman and William DeMeo},
  title     = {Universal Algebraic Methods for Constraint Satisfaction Problems},
  journal   = {CoRR},
  volume    = {abs/1611.02867},
  year      = {2016},
  url       = {http://arxiv.org/abs/1611.02867},
  timestamp = {Thu, 01 Dec 2016 19:32:08 +0100},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/BergmanD16},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}
  @BOOK{HM:1988,
    AUTHOR = {Hobby, David and McKenzie, Ralph},
    TITLE = {The structure of finite algebras},
    SERIES = {Contemporary Mathematics},
    VOLUME = {76},
    PUBLISHER = {American Mathematical Society},
    ADDRESS = {Providence, RI},
    YEAR = {1988},
    PAGES = {xii+203},
    ISBN = {0-8218-5073-3},
    MRCLASS = {08A05 (03C05 08-02 08B05)},
    MRNUMBER = {958685 (89m:08001)},
    MRREVIEWER = {Joel Berman},
    note = {Available from:
      \href{http://math.hawaii.edu/~ralph/Classes/619/HobbyMcKenzie-FiniteAlgebras.pdf}{math.hawaii.edu}}
  }
@article {MR1358491,
    AUTHOR = {Kearnes, Keith A.},
     TITLE = {Varieties with a difference term},
   JOURNAL = {J. Algebra},
  FJOURNAL = {Journal of Algebra},
    VOLUME = {177},
      YEAR = {1995},
    NUMBER = {3},
     PAGES = {926--960},
      ISSN = {0021-8693},
     CODEN = {JALGA4},
   MRCLASS = {08B10 (08B05)},
  MRNUMBER = {1358491},
MRREVIEWER = {H. Peter Gumm},
       DOI = {10.1006/jabr.1995.1334},
       URL = {http://dx.doi.org/10.1006/jabr.1995.1334},
}
@article {MR3076179,
    AUTHOR = {Kearnes, Keith A. and Kiss, Emil W.},
     TITLE = {The shape of congruence lattices},
   JOURNAL = {Mem. Amer. Math. Soc.},
  FJOURNAL = {Memoirs of the American Mathematical Society},
    VOLUME = {222},
      YEAR = {2013},
    NUMBER = {1046},
     PAGES = {viii+169},
      ISSN = {0065-9266},
      ISBN = {978-0-8218-8323-5},
   MRCLASS = {08B05 (08B10)},
  MRNUMBER = {3076179},
MRREVIEWER = {James B. Nation},
       DOI = {10.1090/S0065-9266-2012-00667-8},
       URL = {http://dx.doi.org/10.1090/S0065-9266-2012-00667-8},
}
  @article {MR2893395,
    AUTHOR = {Barto, Libor and Kozik, Marcin},
    TITLE = {Absorbing subalgebras, cyclic terms, and the constraint
      satisfaction problem},
    JOURNAL = {Log. Methods Comput. Sci.},
    FJOURNAL = {Logical Methods in Computer Science},
    VOLUME = {8},
    YEAR = {2012},
    NUMBER = {1},
    PAGES = {1:07, 27},
    ISSN = {1860-5974},
    MRCLASS = {68Q17 (08A70)},
    MRNUMBER = {2893395},
    DOI = {10.2168/LMCS-8(1:7)2012},
    URL = {http://dx.doi.org/10.2168/LMCS-8(1:7)2012}
  }
  @article {MR3374664,
    AUTHOR = {Barto, Libor and Kozik, Marcin and Stanovsk{\'y}, David},
    TITLE = {Mal'tsev conditions, lack of absorption, and solvability},
    JOURNAL = {Algebra Universalis},
    FJOURNAL = {Algebra Universalis},
    VOLUME = {74},
    YEAR = {2015},
    NUMBER = {1-2},
    PAGES = {185--206},
    ISSN = {0002-5240},
    MRCLASS = {08B05 (08A05)},
    MRNUMBER = {3374664},
    DOI = {10.1007/s00012-015-0338-z},
    URL = {http://dx.doi.org/10.1007/s00012-015-0338-z},
  }  
}
\end{filecontents*}
%:biblio
\documentclass[11pt]{amsart}
% The following \documentclass options may be useful:
% preprint      Remove this option only once the paper is in final form.
% 10pt          To set in 10-point type instead of 9-point.
% 11pt          To set in 11-point type instead of 9-point.
% numbers       To obtain numeric citation style instead of author/year.

%% \usepackage{setspace}\onehalfspacing

\usepackage{amsmath}
\usepackage{amscd,amssymb,amsthm} %, amsmath are included by default
\usepackage{latexsym,mathrsfs,enumerate,ifthen}
\usepackage{stmaryrd}
\SetSymbolFont{stmry}{bold}{U}{stmry}{m}{n}
\usepackage{mathtools}
\usepackage[mathcal]{euscript}
\usepackage[colorlinks=true,urlcolor=black,linkcolor=black,citecolor=black]{hyperref}
\usepackage{url}
\usepackage{scalefnt}
\usepackage{tikz}
\usepackage{color}
\usetikzlibrary{calc}
\usepackage[margin=1in]{geometry}
\usepackage{scrextend}
\usepackage{comment}

%%////////////////////////////////////////////////////////////////////////////////
%% Theorem styles
\numberwithin{equation}{section}
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{prop}[theorem]{Proposition}
\theoremstyle{definition}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{notation}[theorem]{Notation}
\newtheorem{Fact}[theorem]{Fact}
\newtheorem*{fact}{Fact}
\newtheorem{example}[theorem]{Example}
\newtheorem{examples}[theorem]{Examples}
\newtheorem{exercise}{Exercise}
\newtheorem*{lem}{Lemma}
\newtheorem*{cor}{Corollary}
\newtheorem*{remark}{Remark}
\newtheorem*{remarks}{Remarks}
\newtheorem*{obs}{Observation}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Acronyms
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% \usepackage[acronym, shortcuts]{glossaries}
%\usepackage[smaller]{acro}
\usepackage[smaller]{acronym}
\usepackage{xspace}

%% \acs{CSP} -- short version of the acronym\\
%% \acl{CSP} -- expanded acronym without mentioning the acronym.\\
%% \acp{CSP} -- plurals.\\
%% \acfp{CSP} -- long forms into plurals.\\
%% \acsp{CSP} -- short form into a plural.\\
%% \aclp{CSP} -- long form into a plural.\\
%% \acfi{CSP} -- Full Name acronym in italics and abbreviated form in upshape.\\
%% \acsu{CSP} -- short form of the acronym and marks it as used.\\
%% \aclu{CSP} -- Prints the long form of the acronym and marks it as used.\\

\acrodef{lics}[LICS]{Logic in Computer Science}
\acrodef{sat}[SAT]{satisfiability}
\acrodef{nae}[NAE]{not-all-equal}
\acrodef{ctb}[CTB]{cube term blocker}
\acrodef{tct}[TCT]{tame congruence theory}
\acrodef{wnu}[WNU]{weak near-unanimity}
\acrodef{CSP}[CSP]{constraint satisfaction problem}
\acrodef{MAS}[MAS]{minimal absorbing subuniverse}
\acrodef{MA}[MA]{minimal absorbing}
\acrodef{cib}[CIB]{commutative idempotent binar}
\acrodef{sd}[SD]{semidistributive}
\acrodef{NP}[NP]{nondeterministic polynomial time}
\acrodef{P}[P]{polynomial time}
\acrodef{PeqNP}[P $ = $ NP]{P is NP}
\acrodef{PneqNP}[P $ \neq $ NP]{P is not NP}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% \usepackage{inputs/proof-dashed}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Put new macros in the macros.sty file
\usepackage{inputs/macros}

\begin{document}

\title[Difference Term Operation for $\bF_{\sV}(2)$]
{Difference term operations for finite 2-generated idempotent free algebras}
\date{\today}
% \author[W.~DeMeo]{William DeMeo}
\address{University of Hawaii}
\email{williamdemeo@gmail.com}

%% \thanks{The authors would like to extend special thanks to...}

\begin{abstract}
This note provides some tools that should enable us to prove
the following: if $\bA$ is a finite idempotent algebra with a
difference term operation, then the 2-generated free algebra in $\bbV(\bA)$ has
a difference term operation.  
\end{abstract}

\maketitle

\renewcommand{\etaR}{\ensuremath{\eta}}


\section{Definitions and Preliminary Facts}
\label{sec:facts}

Let $\sV$ be a variety (equational class) of algebras.
A ternary term $d$ in the language of $\sV$ is called 
a \defn{difference term for $\sV$} if it satisfies the following:
%% for all $\bA = \<A, \dots \> \in \sV$ and $a, b \in A$ we have
for all $\bA = \<A, \dots \> \in \sV$, for all $a, b \in A$, for every 
congruence $\theta\in \Con\bA$ containing $(a,b)$, we have
\begin{equation}
  \label{dt-rel}
  a \comr{\theta} d^{\bA}(a,b,b), \; \text{ and }
\end{equation}
\begin{equation}
  \label{dt-id}
d^{\bA}(a,a,b) = b, 
\end{equation}
where %% $\theta$ is any congruence of $\bA$ containing $(a,b)$ and
$[\cdot, \cdot]$ denotes the (term condition) commutator
%% defined in Section~\ref{sec:definitions} below
(see also~\cite{HM:1988} or~\cite{MR3076179}).
(By the monotonicity of the commutator, we could replace $\theta$ in the
definition by $\Cg^{\bA}(a,b)$.)

Notice that part of
the definition of a difference term involves one of
the identities satisfied by a Malcev term, namely
(\ref{dt-id}). Below we refer to this as the ``strong (difference term) identity,''
and we refer to (\ref{dt-rel}) as the ``weak (difference term) relation.''
We refer to (\ref{dt-rel}) and (\ref{dt-id}) collectively as the ``difference term
realtions.''

Suppose $\bA$ is an algebra and for all $a,b \in A$
the operation $d^{\bA}$ satisfies the difference term relations when
$\theta = \Cg^{\bA}(a,b)$, then we call $d^{\bA}$
a \defn{difference term operation} for $\bA$
(whether or not $d$ is a difference
term for the whole variety inhabited by $\bA$).

If $d$ is idempotent, it may be convenient to present the difference term
relations as follows:
\begin{equation}
  \label{dt-rel-idemp}
  d^{\bA}(a,a,a) \comr{\theta} d^{\bA}(a,b,b), \; \text{ and }
\end{equation}
\begin{equation}
  \label{dt-id-idemp}
d^{\bA}(a,a,b) =   d^{\bA}(b,b,b).
\end{equation}

In Lemma~\ref{lem:preliminary-facts} we gather
some easy facts that will be useful below.
We use $\Com{\theta}$ as a convenient shorthand for 
$[\theta,\theta]$. %% (= the term condition commutator of $\theta$ with itself).
\begin{lemma}
\label{lem:preliminary-facts}
Let $\sV$ be an idempotent variety and suppose 
$\bF = \<F, \dots\> = \bF_{\sV}(x,y)$ is finite. 
%% Let $\bF_0 \times \bF_1$ be the product of two copies of $\bF$.
Let $\bR = \<R, \dots\> = \Sg^{\bF^2}\{(x, x), (x, y), (y, y)\}$. 
% the subalgebra of $\bF^2$ generated by the set $\{(x, x), (x, y), (y, y)\}$.
Then the following hold:
\begin{enumerate}
\item \label{item:1}
  $\Cg^{\bF}(x,y) = 1_F$.

  \smallskip
\item \label{item:1.5}
  If $[1_F, 1_F] = 1_F$ (i.e., $1_F$ is ``neutral''), then
  $\bF$ has a difference term operation.

\smallskip
\item \label{item:2}
The quotient algebra $\bF/\Com{\Cg^{\bF}(x,y)} = \bF/[1_F,1_F]$ is abelian.


\smallskip
\item \label{item:3}
  $\bR$ is a subdirect product of %$\bF_0$ and $\bF_1$.
  $\bF\times \bF$.

\smallskip
\item \label{item:4}
$\bigl(\{x\} \times F\bigr) \cup \bigl(F \times \{y\}\bigr) \subseteq R$.

\end{enumerate}
\end{lemma}


\pagebreak  

\begin{proof}\
  \begin{enumerate}
  \item  In fact, $\Cg^{\bB}(a,b)=1_B$ holds for every
    2-generated idempotent algebra, $\bB = \Sg^{\bB}(a,b)$, with generators
    $a$ and $b$.  If $(c,c') \in B^2$, then there are terms $s$ and $t$
    such that $s(a,b) = c$ and $t(a,b) = c'$.  Therefore, 
    $(c,b) = (s(a,b), s(b,b))$ belongs to $\Cg^{\bB}(a,b)$; likewise
    $(a,c') = (t(a,a), t(a,b))$ belongs to $\Cg^{\bB}(a,b)$, so
    $c \mathrel{\Cg^{\bF}(x,y)} b\mathrel{\Cg^{\bF}(x,y)} a \mathrel{\Cg^{\bF}(x,y)} c'$,
    as desired.
    %% NEW PROOF: (finish this later if necessary)\\
    %% Consider the homomorphism from $\bF:= \bF_{\sV}(x,y)$ onto the 1-generated free
    %% algebra $\bF_{\sV}(z)$ that maps both $x$ and $y$ to $z$.  The kernel
    %% $\theta$ is a congruence that contains $(x,y)$, so
    %% $\Cg^{\bF}(x,y)\leq \theta$.... 
    
    
  \item If $[1_F,1_F] = \Com{\Cg^{\bF}(x,y)} = \Cg^{\bF}(x,y) = 1_F$, then every term
  trivially satisfies the condition
  $t^{\bF}(x,y,y) \Comr{\Cg^{\bF}(x,y)} x$.  Therefore, the third projection
  $d^{\bF}(x,y,z) = z$ is a difference term operation for $\bF$.

\item  This holds because %, by (\ref{item:1}),
  $\Com{\Cg^{\bF}(x,y)} = \com{1_F}$ and $\CC{1_F}{1_F}{\com{1_F}}$
  implies $\CC{1_{F/\delta}}{1_{F/\delta}}{0_{F/\delta}}$, where
  $\delta := \com{1_F}$.

\item It is obvious. 
(We denote this by $\bR \sdp \bF_0 \times \bF_1$.)


\item
  Since $\bF$ is idempotent, $\{x\}$ is a subuniverse of $\bF$, and since
  $\{x, y\}$ generates $\bF$, we see that
  $\{x\} \times \bF \leq \Sg^{\bF^2}\{(x,x), (x,y)\}\leq \bR$.
  Similarly, $\bF\times \{y\} \leq \Sg^{\bF^2}\{(x,y), (y,y)\}\leq \bR$.
  Therefore,
  $\bigl(\{x\} \times F\bigr) \cup \bigl(F \times \{y\}\bigr) \subseteq R$.
  \end{enumerate}

\end{proof}


It is sometimes convenient to have indexed copies of $\bF$; viz.,
let $\bF_i \cong \bF$ denote the ``$i$-th copy'' of $\bF$. 
For instance, in the next lemma $\bF_0 \times \bF_1$ denotes the product of two
copies of $\bF$. 
\begin{lemma}
Let $\sV$ be an idempotent variety and assume
$\bF = \<F, \dots\> = \bF_{\sV}(x,y)$ is finite.
%% let $\bF_0 \times \bF_1$ be the product of two copies of $\bF$, and 
If $\bR = \Sg^{\bF^2}\{(x, x), (x, y), (y, y)\}$, and if  
% the subalgebra of $\bF^2$ generated by the set $\{(x, x), (x, y), (y, y)\}$.
$\etaR_i$ denotes the kernel of the
$i$-th projection $\bR \onto \bF_i$, then 
$\etaR_0 \join \etaR_1 = 1_R$ and 
$\etaR_0 \circ \etaR_1 \circ \etaR_0 = \etaR_0 \join \etaR_1 = 
  \etaR_1 \circ \etaR_0 \circ \etaR_1$.
\end{lemma}
\begin{proof}
  By Lemma~\ref{lem:preliminary-facts}~(\ref{item:4}), for every $b \in F$ the
  pair $(x,b)$ lies in $R$, and for every  $a\in F$ the pair $(a,y)$ lies in $R$.
  It follows that the projection kernels $\etaR_0$ and $\etaR_1$ 3-permute and
  join to $1_R$.
  % \[\etaR_0 \circ \etaR_1 \circ \etaR_0 = \etaR_1 \circ \etaR_0 \circ \etaR_1 =
  % \etaR_0 \join \etaR_1 = 1_R. \]
  Indeed, if $(a,b)$ and $(a',b')$ are arbitrary pairs in $R$, then
  %% \[(a,b) \mathrel{\etaR_0} (a,y) \mathrel{\etaR_1} (a',y) \mathrel{\etaR_0}
  %%   (a',b') \quad \text{ and } \quad 
  %% (a,b) \mathrel{\etaR_1} (x,b) \mathrel{\etaR_0} (x,b') \mathrel{\etaR_1} (a',b'). \]
  $(a,b) \mathrel{\etaR_0} (a,y) \mathrel{\etaR_1} (a',y) \mathrel{\etaR_0} (a',b')$ and 
  $(a,b) \mathrel{\etaR_1} (x,b) \mathrel{\etaR_0} (x,b') \mathrel{\etaR_1} (a',b')$.
\end{proof}


  %% NEW PROOF:
  %% Since $\bF$ is idempotent, $\{x\}$ is a subuniverse of $\bF$, and since
  %% $\{x, y\}$ generates $\bF$, we see that
  %% $\{x\} \times \bF \leq \Sg^{\bF^2}\{(x,x), (x,y)\}\leq \bR$.
  %% Similarly, $\bF\times \{x\} \leq \Sg^{\bF^2}\{(x,x), (y,x)\}\leq \bR$.
  %% Therefore,
  %% \[
  %% \{x\} \times \bF \cup \bF \times \{x\} \subseteq \bR.
  %% \]
  %% In particular, for every $b \in F$ the pair $(x,b)$ lies in $R$, and for every
  %% $a\in F$ the pair $(a,x)$ lies in $R$.

  %% NEW NEW PROOF:
  % Since $\bF$ is idempotent, $\{x\}$ is a subuniverse of $\bF$, and since
  % $\{x, y\}$ generates $\bF$, we see that
  % $\{x\} \times \bF \leq \Sg^{\bF^2}\{(x,x), (x,y)\}\leq \bR$.
  % Similarly, $\bF\times \{y\} \leq \Sg^{\bF^2}\{(x,y), (y,y)\}\leq \bR$.
  % Therefore,
  % \[
  % \bigl(\{x\} \times \bF\bigr) \cup \bigl(\bF \times \{y\}\bigr) \subseteq \bR.
  % \]
  % In particular, for every $b \in F$ the pair $(x,b)$ lies in $R$, and for every
  % $a\in F$ the pair $(a,y)$ lies in $R$.
  % It follows that the projection kernels $\eta_0$ and $\eta_1$ 3-permute:
  % \[
  % \eta_0 \circ \eta_1 \circ \eta_0 = 
  % \eta_1 \circ \eta_0 \circ \eta_1 =
  % \eta_0 \join \eta_1 = 1_R.
  % \]
  % Indeed, if $(a,b)$ and $(a',b')$ are arbitrary pairs in $R$, then
  %% OLD PROOF:
  %% \[ (a,b) \mathrel{\eta_0} (a,x) \mathrel{\eta_1} (a',x) \mathrel{\eta_0} (a',b'). \]
  %% \[ (a,b) \mathrel{\eta_1} (x,b) \mathrel{\eta_0} (x,b') \mathrel{\eta_1} (a',b'). \]
  %% NEW PROOF:
%   \[ (a,b) \mathrel{\eta_0} (a,y) \mathrel{\eta_1} (a',y) \mathrel{\eta_0} (a',b'). \]
%   and
%   \[ (a,b) \mathrel{\eta_1} (x,b) \mathrel{\eta_0} (x,b') \mathrel{\eta_1} (a',b'). \]
% \end{proof}

\subsection{Some useful facts about abelian algebras}
\label{sec:facts-about-abelian}

An very useful property of abelian algebras is that they are absorption-free.
We record this fact for future reference.
\begin{lemma}
  \label{lem:abelian-AF}
  Finite idempotent abelian algebras are absorption-free.
\end{lemma}
A proof of Lemma~\ref{lem:abelian-AF} appeared in~\cite[Lem~4.1]{MR3374664};
we include a similar proof in Appendix Section~\ref{sec:proof-that-abelian} for easy
reference and to keep the paper somewhat self-contained.
Another well-known result, whose proof also appears in the appendix
(see Section~\ref{sec:abel-algebr-diag}) is the following useful fact:
\begin{lemma}
  \label{lem:diagonal-cong-class}
 An algebra $\bA$ is abelian if and only if there is some 
 $\theta \in \Con (\bA^2)$ that has the diagonal $0_A:= \{(a,a): a \in A\}$ 
 as a congruence class.
\end{lemma}


\begin{comment}

\subsection{Alternate description of the commutator}
\label{sec:altern-descr-comm}
The description of the commutator presented in this section can be 
useful when we need to establish that a specific pair of elements
belongs to the commutator in question. This  description is
similar to the one in~\cite[p.~930]{MR1358491}.

If $\alpha$  and $\beta$ are binary relations on $A$,
we let $\alpha \mytimes \beta$ denote
the following binary relation on $A^2$:
\[
\alpha \mytimes \beta := \{\bigl((x,y), (x', y')\bigr) \mid x\alphar x' \text{
  and } y\betar y'\}.
\]  
We reserve $\alpha \times \beta$ for the usual Cartesian product
\[
\alpha \times \beta := \{\bigl((x,x'), (y, y')\bigr) \mid x\alphar x' \text{
  and } y\betar y'\}.
\]  
For an algebra $\bA$ with congruence relations $\alpha$, $\beta\in \Con\bA$,
let $\bbeta$ denote the subalgebra of $\bA\times \bA$ with universe 
$\beta$.
Let $0_A = \{(a,a) \mid a\in A\}$, let
\begin{align}
D_\alpha&:=(\alpha \mytimes \alpha) \cap (0_A\times 0_A) = 
\{((a,a), (b,b)) \in 0_A \times 0_A \mid a\alphar b\}, \text{ and let }\\
\Delta_{\beta, \alpha} &:= \Cg^{\bbeta}(D_\alpha ). 
\end{align}
%% That is, \Delta_{\beta, \alpha} is the congruence on $\bbeta$ generated by the set $D^2_\alpha$.
As usual, the congruence class of $\Delta_{\beta, \alpha}$ containing
$(b,b')$ is denoted and defined by 
\[
(b,b')/\Delta_{\beta,\alpha} = \{(a,a') \in \beta \mid (a,a') \mathrel{\Delta_{\beta,\alpha}} (b,b')\}.
\]
In our application below, the most important special case will concern 
a finite 2-generated free algebra $\bF := \bF_{\sV}(x,y)$ over an idempotent
variety $\sV$. 
When the context makes the meaning clear, we sometimes write $1$ instead of
$1_F$ or $F \times F$. 
As noted above in Lemma~\ref{lem:preliminary-facts}, 
$\Cg^{\bF}(x,y) = 1$, so we will be especially interested in 
\begin{equation}
\label{eq:11}  
\Delta_{1, 1} := \Cg^{F\times F}\{\bigl((x,x), (y,y)\bigr) \mid x, y \in F\}.
\end{equation}
Recall that $\bF$ is abelian if and only if
 $\exists\, \theta \in \Con (\bF^2)$ with the diagonal $0_F:= \{(z,z)\mid z \in F\}$ 
 as a congruence class. 
 Thus if $\bF$ is nonabelian, then there exist
 $u, v\in F$ such that
 $u \neq v$ and $(u,v)\mathrel{\Delta_{1,1}}(x,x)$,
 for all $x\in F$. 
 (Otherwise, $0_F$ is a congruence class of $\Delta_{1,1}$.)
%% For the purpose of deciding whether there exists a difference
%% term we can assume the algebras in question is nonabelian. 
%%  (We will see below why the nonabelian assumption comes without loss of generality.)
%%  Recall from Lemma~\ref{lem:diagonal-cong-class}
%%  that an algebra is abelian if and only if there is some 
%%  $\theta \in \Con (\bA^2)$ that has the diagonal $0_A:= \{(a,a)\mid a \in A\}$ 
%%  as a congruence class.
%%  Thus, if $\bF$ is nonabelian, then there must be 
%%  $u, v\in F$ such that
%%  $u \neq v$ and $ (u,v)\mathrel{\Delta_{1,1}}(x,x)$ (for all $x\in F$).

Let $\Phi_{\beta, \alpha} \colon \sP(\beta) \to \sP(\beta)$ be the function that
takes each $B \subseteq \beta$ to
\begin{equation}
  \label{eq:6}
  \Phi_{\beta, \alpha}(B) = \bigcup_{(b,b')\in B} (b,b')/\Delta_{\beta, \alpha}.
\end{equation}
Let $\Psi_{\beta, \alpha} \colon \Eq(\beta) \to \Eq(\beta)$ be the function that
takes each $R \in \Eq(\beta)$ to the equivalence relation
\begin{align*}
  \Psi_{\beta, \alpha}(R) &= \Delta_{\beta, \alpha} \circ (R \mytimes R) \circ \Delta_{\beta, \alpha} \\
  &= \{\bigl((x,y), (x',y')\bigr) \mid \bigl(\exists (r, r') \in R\bigr) \;
  \bigl((x,y) \mathrel{\Delta_{\beta, \alpha}} (r,r) \; \text{ and } \;  (r',r')
  \mathrel{\Delta_{\beta, \alpha}} (x'y')\bigr)\}\\
  &= \{\bigl((x,y), (x',y')\bigr) \mid \bigl(\exists (r, r')\bigr) \;
  (x,y) \mathrel{\Delta_{\beta, \alpha}} (r,r) \mathrel{(R \mytimes R)} (r',r')
  \mathrel{\Delta_{\beta, \alpha}} (x'y')\}.
\end{align*}
%% \newcommand{\Phiba}{\ensuremath{\Phi_{\beta, \alpha}}}
\newcommand{\Phiba}{\ensuremath{\Phi}}
\newcommand{\Psiba}{\ensuremath{\Psi}}

We are finally ready to give the promised alternative description of the
commutator $[\alpha, \beta]$. 
% (Spoiler alert! It is the least fixed point of $\Phi_{\beta, \alpha}$.)
\begin{lemma}
  \label{lem:fixed-point-comm}
  Let $\bA$ be an algebra with $\alpha$, $\beta\in \Con(\bA)$.
  If $\Phi:=\Phi_{\beta, \alpha}$ is defined as in~(\ref{eq:6}), then 
  \begin{enumerate}[(i)]
  \item \label{item:111} $\Phiba$ is a closure operator on $\sP(\beta)$;
  \item \label{item:222} $[\alpha, \beta]$ is the least fixed point of $\Phiba$.
  \end{enumerate}
\end{lemma}
\noindent (A proof of Lemma~\ref{lem:fixed-point-comm} appears in Appendix
Section~\ref{sec:fixed-point-lemma} below.)

\end{comment}

\section{Main Result}
Our goal is to prove Theorem~\ref{thm:main-result} below. Our proof will use the following lemma.
%% $\bF = \<F, \dots\> = \bF_{\sV}(x,y)$ is finite. 
\begin{lemma}
  If $d$ is a difference term operation for $\bA$,
  then $d(x,x,y) \approx y$ holds in $\sV = \bbV(\bA)$.
  In particular, interpreted in the 2-generated free algebra
  $\bF := \bF_{\sV}(x,y)$, we have $d^{\bF}(x,x,y) = y$.
\end{lemma}
\begin{proof}
  $d(x,x,y) \approx y$ is an identity in
  $\sV = \sansH \sansS \sansP(\bA)$ since 
  $d^{\bA}(a,a,b) = b$ holds $\forall a, b \in A$.
  %% is an identity in $\bA$.
  %% OLD PROOF:
  %% One way to see this is to note that $\bF$ is a subdirect product of some
  %% finite number of 2-generated subalgebras of $\bA$, say,
  %% $\bF \sdp \bA_0 \times \cdots \times \bA_{n-1}$. Also, when interpreted
  %% in the subalgebra $\bA_i \leq \bA$, the term $d$ at least obeys the Malcev
  %% part of the difference term conditions that it satisfies when interpreted in $\bA$.
  %% That is,   $d^{\bA_i}(a_i, a_i, b_i) = b_i$ for all $a_i, b_i \in A_i$.
  %% Therefore, if $x = (a_0, \dots, a_{n-1})$ and $y = (b_0, \dots, b_{n-1})$, then we have
  %% \[d^{\bF}(x,x,y) = (d^{\bA_0}(a_0, a_0, b_0),
  %% \dots,d^{\bA_{n-1}}(a_{n-1}, a_{n-1}, b_{n-1})) = (b_0, \dots, b_{n-1}) = y.\]
\end{proof}
  % Fix $a, b\in A$ and suppose $\phi: \bF \to \bA$ is a homomorphism with
  % $\phi(x) = a$ and $\phi(y) = b$.  Then
  % we have
  % $\phi(d^{\bF}(x,x,y)) = d^{\bA}(\phi(x),\phi(x),\phi(y)) = d^{\bA}(a,a,b) = b$,
  % so $(d^{\bF}(x,x,y), y) \in \ker \phi$. Therefore, we must have
  % $d^{\bF}(x,x,y) = y$, so $d^{\bF}$ is a difference term operation for $\bF$.



\begin{theorem}
\label{thm:main-result}
Let $\bA = \<A, \dots\>$ be a finite idempotent algebra.
% and $\sV = \bbV(\bA)$ the
% variety it generates.  A
Assume $\bA$ has a difference term operation and 
$\sV = \bbV(\bA)$ has a Taylor term.
Then $\bF = \bF_{\sV}(x,y)$ has a difference term operation.
%% Assume $\bF \sdp \bA \times \bB$.
\end{theorem}
\begin{proof}
Let $\bF_0 \times \bF_1$ be the product of two copies of $\bF$,
and let $\bR \sdp \bF_0 \times \bF_1$ be the subalgebra generated
by the set $\{(x, x), (x, y), (y, y)\}$ (as above).
Recall from Lemma~\ref{lem:preliminary-facts}~(\ref{item:1}) that
$\Com{\Cg^{\bF}(x,y)} = [1_{F},1_{F}]$.  Therefore, if we can prove 
\begin{equation}
  \label{eq:001}
%% R \cap \bigl(\{y\} \times (x/\Com{\Cg^{\bF_1}(x,y)})\bigr) \neq \emptyset.
R \cap \bigl(\{y\} \times (x/[1_{F_1},1_{F_1}])\bigr) \neq \emptyset,
\end{equation}
then it will follow that there is a term $t$ satisfying
\[
t^{\bF^2}((x,x),(x,y),(y,y)) =\bigl(t^{\bF}(x,x,y), t^{\bF}(x,y,y)\bigr) \in
\{y\} \times \bigl(x/\Com{\Cg^{\bF}(x,y)}\bigr).
%% \{y\} \times \bigl(x/[1_{F_1},1_{F_1}]\bigr).
\]
That is,
%% \begin{equation}
%%   \label{dt2-rel}
%%   x \Comr{\Cg^{\bF}(x,y)} t^{\bF}(x,y,y), \;  \text{ and }
%% \end{equation}
%% \begin{equation}
%%   \label{dt2-id}
%% t^{\bF}(x,x,y) = y.
%% \end{equation}
$(t^{\bF}(x,y,y),x) \in \Com{\Cg^{\bF}(x,y)}$ and
$t^{\bF}(x,x,y) = y$, which means that $t^{\bF}$ is a difference term operation 
for $\bF$.  In short, to prove the theorem it suffices to establish~(\ref{eq:001}). 

%% Of course, $[1_F, 1_F]\leq 1_F$ and
%% Lemma~\ref{lem:preliminary-facts}~(\ref{item:1.5}) dispenses with 
%% the case in which these congruences are equal.
%% So, assume $[1_F, 1_F]< 1_F$.
%% In particular, $(x,y) \notin [1_F, 1_F]$.

%% Now $\Com{\Cg^{\bF}(x,y)}$ and $\Cg^{\bF}(x,y)$ are both subalgebras of $\bF^2$
%% and by idempotence, each class of each of these congruences is a subalgebra of $\bF$.
%% By Lemma~\ref{lem:preliminary-facts}~(\ref{item:1}) we have 
%% $\Cg^{\bF}(x,y) = 1_F$ and $\Com{\Cg^{\bF}(x,y)} = [1_F,1_F]$, so our assumption
%% is $[1_F,1_F]< 1_F$.  
%% Recall from Lemma~\ref{lem:preliminary-facts}~(\ref{item:2}) that the
%% algebra $\bF/[1_F, 1_F]$ is abelian.
Observe that $\bR/\etaR_i \cong \bF_i$ for $i \in \{0,1\}$.
Let $\rho_1 \in \Con(\bR)$ be the congruence
(above $\etaR_1$) corresponding to $[1_{F_1}, 1_{F_1}]$ via the projection
homomorphism $\bR \onto \bF_1$.  Thus,
\[
\bR/\rho_1 \cong (\bR/\etaR_1)/(\rho_1/\etaR_1) \cong \bF_1/[1_{F_1}, 1_{F_1}],
\]
so $\bR/\rho_1$ is abelian
(by Lemma~\ref{lem:preliminary-facts}~(\ref{item:2})).
Moreover, $\bR/(\etaR_0\meet \rho_1)$ is a subdirect
product of $\bR/\etaR_0 \cong \bF_0$ and  
$\bR/\rho_1 \cong \bF_1/[1_{F_1}, 1_{F_1}]$.  That is,
\[
\bR/(\etaR_0\meet \rho_1) \sdp \bF_0\times 
\bigl(\bF_1/[1_{F_1}, 1_{F_1}]\bigr).
\]
Let  $\tau_0 := \etaR_0/(\etaR_0\meet \rho_1)$ be the kernel of the
projection of $\bR/(\etaR_0\meet \rho_1)$ onto $\bF_0$, and 
$\tau_1 := \rho_1/(\etaR_0\meet \rho_1)$ the kernel of the
projection of $\bR/(\etaR_0\meet \rho_1)$ onto $\bF_1/[1_{F_1},1_{F_1}]$.
Then,
\begin{align*}
\bigl(\bR/(\etaR_0\meet \rho_1)\bigr)/\tau_0&=
\bigl(\bR/(\etaR_0\meet \rho_1)\bigr)/\bigl(\etaR_0/(\etaR_0\meet \rho_1)\bigr)
\cong \bR/\etaR_0 \cong \bF_0\\
\bigl(\bR/(\etaR_0\meet \rho_1)\bigr)/\tau_1&=
\bigl(\bR/(\etaR_0\meet \rho_1)\bigr)/\bigl(\rho_1/(\etaR_0\meet \rho_1)\bigr)
\cong \bR/\rho_1 \cong \bF_1/[1_{F_1},1_{F_1}].
\end{align*}
Next observe that
%% Then $\bR/(\rho_0\meet \rho_1)$ is a subdirect product of $\bF_0/[1_{F_0}, 1_{F_0}]$ and 
%% $\bF_1/[1_{F_1}, 1_{F_1}]$.  That is
%% \[
%% \bR/(\rho_0\meet \rho_1) \sdp \bF_0/[1_{F_0}, 1_{F_0}] \times 
%% \bF_1/[1_{F_1}, 1_{F_1}].
%% \]
%% Next observe that if $\tau_i$ denotes the kernel of the projection of 
%% $\bR/(\rho_0\meet \rho_1)$ onto $\bF_i/[1_{F_i}, 1_{F_i}]$, then 
$\tau_0\join \tau_1 = 1_{R/(\etaR_0\meet \rho_1)}$. (This is clear since
$\rho_1\geq \eta_1$, so  $\eta_0 \join \rho_1 \geq \eta_0 \join \eta_1 = 1_R$.)
Thus, by the Absorption Theorem (Thm.~\ref{thm:absorption} below),
exactly one of the following holds:
\begin{enumerate}
\item \label{item:7} $\bF_0$ has a proper minimal absorbing subuniverse;
\item \label{item:8} $\bF_1/[1_{F_1}, 1_{F_1}]$ has a proper minimal
  absorbing subuniverse; 
\item \label{item:6} $\bR/(\eta_0\meet \rho_1) =\bF_0 \times \bigl(\bF_1/[1_{F_1}, 1_{F_1}]\bigr)$.
\end{enumerate}

(From now on we drop the subscripts on $\bF$, since distinguishing between the
first and second factors of the product is no longer helpful.)
If~(\ref{item:6}) holds, then we're done since in that case
$(y, x/[1_{\Fone},1_{\Fone}]) \in R/(\etaR_0 \meet \rho_1)$,
which implies $(y, z) \in R$ for some $z \comr{1_{\Fone}} x$.
That is, (\ref{eq:001}) holds.
We can rule out case~(\ref{item:8}) because $\bFone/[1_{\Fone}, 1_{\Fone}]$ is abelian and
is therefore absorption free
(see~Appendix Section~\ref{sec:proof-that-abelian} below).
%% (see~\cite{MR3374664} or~\cite{Bergman-DeMeo-2016}.)
%% so $\Fone/[1_{\Fone}, 1_{\Fone}]$ is the minimal absorbing subuniverse of $\bFone/[1_{\Fone}, 1_{\Fone}]$.


We are left with case~(\ref{item:7}).
Let $B$ be a proper minimal absorbing subuniverse of $\bF_0$.
Then the product algebra $\bB\times \bigl(\bFone/[1_{\Fone}, 1_{\Fone}]\bigr)$ is
absorbtion free.
Since $\bR/(\etaR_0 \meet \rho_1)$ is subdirect, the intersection
$R/(\etaR_0 \meet \rho_1) \cap \bigl(B \times (\Fone/[1_{\Fone}, 1_{\Fone}])\bigr)$ is
non-empty. Therefore, by the Absorption Theorem (Thm.~\ref{thm:absorption}),
together with~\cite[Lemmas~4.7, 4.9, 4.11, 4.12]{Bergman-DeMeo-2016},
we have
\begin{equation}
  \label{eq:2}
%% \bR/(\etaR_0 \meet \rho_1) \cap \bB \times \Fone/[1_{\Fone}, 1_{\Fone}]
  %% = \bB \times \Fone/[1_{\Fone}, 1_{\Fone}].
B \times \bigl(\Fone/[1_{\Fone}, 1_{\Fone}]\bigr) \subseteq R/(\etaR_0 \meet \rho_1).
%% R/(\etaR_0 \meet \rho_1) \cap B \times \Fone/[1_{\Fone}, 1_{\Fone}]
%% = \bB \times \Fone/[1_{\Fone}, 1_{\Fone}].
\end{equation}
%% This follows from 

We split the remainder of the proof into two subcases.\\
\\
\noindent \underline{Subcase 1:} ($y\in B$)\\[5pt]
In this case we're done, since (\ref{eq:2}) implies
%% $\bB \times \Fone/[1_{\Fone}, 1_{\Fone}] \subseteq \bR/(\etaR_0 \meet \rho_1)$,
${y} \times \bigl(x/[1_{\Fone}, 1_{\Fone}]\bigr) \in R$.\\
\\
\noindent \underline{Subcase 2:} ($x\in B$)\\[5pt]
In this case, we have $x \in B \minabsorbing \bF$, so instead of $\bR$ we
consider $\bR' = \Sg^{\bF^2}\{(y,y), (y,x), (x,x)\}$. We wish to show that there
is a term $t$ satisfying
\[
t^{\bR'}\bigl((y,y), (y,x), (x,x)\bigr) =
\bigl(t^{\bF}(y,y,x), t^{\bF}(y,x,x)\bigr) \in \{x\} \times \bigl(y/[1_F, 1_F]\bigr).
\]
Applying (\ref{eq:2}) again, we have
${x} \times \bigl(y/[1_{\Fone}, 1_{\Fone}]\bigr) \in R'$.\\
%% Or, consider
%% \[
%% d^{\bR'}\bigl((x,x), (y,x), (y,y)\bigr) =
%% \bigl(d^{\bF}(x,y,y), d^{\bF}(x,x,y)\bigr) \in x/[1_F, 1_F] \times \{y\}.
%% \]

\noindent \underline{Subcase 3:} ($x\notin B$ and $y\notin B$)\\[5pt]
\vskip1cm

\noindent TODO: finish proof!!!

  \tikzstyle{lat} = [circle,draw,inner sep=0.8pt]
  \begin{center}
  \begin{figure}
    \caption{The subdirect product $\mathbf R = \Sg^{\bF^2}\{(x,x), (x,y), (y,y)\}$.}
  \begin{tikzpicture}[scale=1]
    \draw (0,.5) ellipse (4mm and 12mm);
    \draw (2,.5) ellipse (4mm and 12mm);
    %% \draw (4,.5) ellipse (4mm and 12mm);
    \node[lat] (00) at (0,0) {};
    \node[lat] (01) at (0,1) {};
    \node[lat] (10) at (2,0) {};
    \node[lat] (11) at (2,1) {};
    %% \node[lat] (20) at (4,0) {};
    %% \node[lat] (21) at (4,1) {};
    \draw (00) node [below]{$x$};
    \draw (01) node [above]{$y$};
    \draw (10) node [below]{$x$};
    \draw (11) node [above]{$y$};
    %% \draw (20) node [below]{$0$};
    %% \draw (21) node [above]{$1$};
    \draw[red,thick] (00) -- (10); % -- (20);
    \draw[blue,thick] (00) -- (11); % -- (21);
    %% \draw[green,thick] (01) -- (10); % -- (21);
    \draw[yellow,thick] (01) -- (11); % -- (20);
    \draw (1,-1) node {(lines represent generators of $R$)};
  \end{tikzpicture}
  %% \nopagebreak[4]
  \end{figure}
  \end{center}
\bigskip


\vfill

\end{proof}
\newpage


% \newpage
\appendix

\section{Product Congruences}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% include file
It is important, especially in this section, to be clear about what we mean
by the product of two equivalence relations.
Let $A$ and $B$ be sets and let $\alpha \in \Eq(A)$ and $\beta \in \Eq(B)$
be equivalence relations on $A$ and $B$, respectively.
We denote by $\alpha \mytimes \beta$ the \emph{pairwise product} relation,
which we define as follows:
\begin{equation}
\label{eq:pair-product}
\alpha \mytimes \beta = \{\bigl((a, b), (a', b')\bigr) 
\in (A\times B)^2 \mid a\mathrel{\alpha} a', \, b\mathrel{\beta} b'\}.
\end{equation}
In contrast, the Cartesian product of $\alpha$ and $\beta$ is 
\begin{equation}
\label{eq:set-product}
\alpha \times \beta = \{\bigl((a, a'), (b, b')\bigr) 
\in A^2\times B^2 \mid a\mathrel{\alpha} a', \, b\mathrel{\beta} b'\}.
\end{equation}

Notice that $\alpha \mytimes \beta$ defines an equivalence relation on the set
$A\times B$, whereas $\alpha\times \beta$ is generally
not even a binary relation on a set.
The equivalence class of $\alpha \mytimes \beta$ containing the pair
$(a, b)$ is % \in A\times B$ is
  \[(a,b)/(\alpha \mytimes \beta) = a/\alpha \times b/\beta= 
    \{(a', b') \in A\times B \mid a\mathrel{\alpha} a', \, b\mathrel{\beta} b'\},
    \]
This is simply the Cartesian product of the sets $a/\alpha$ and $b/\beta$.
The collection of all such equivalence classes is also a Cartesian product, namely,
\[
(A\times B)/(\alpha \mytimes \beta) =
A/\alpha \times B/\beta  = \{(a, b)/(\alpha \mytimes \beta) \mid a\in A,\,b \in B\}.\]
%% \begin{remarks}\
%%   \begin{enumerate}
%%   \item The equivalence relations $\alpha$ and $\beta$ are subsets
%%     of $A^2$ and $B^2$, respectively, so it might seem more natural to interpret 
%%     $\alpha \times \beta$ as a subset of $A^2 \times B^2$. Nonetheless, in this 
%%     context it is usually more convenient to arrange the coordinates 
%%     so that $\alpha \times \beta \subseteq (A \times B)^2$, as in
%%     item~(\ref{item:9}).
%%   \end{enumerate}
%% \end{remarks}

\bigskip


Let $\alg{L}$ be a sublattice of the lattice $\Eq(A)$ of all
equivalence relations on a finite set $A$.  Fix $\alpha \in L$ and consider 
the lattice $\Eq(\alpha)$ of equivalence relations on
$\alpha\subseteq A^2$.  The bottom and top elements of $\Eq(\alpha)$
are, respectively, 
\[
0_\alpha = \{\bigl((x, y), (x, y)\bigr) \mid x \mathrel{\alpha} y \},
%% 0_\alpha = \{\bigl((a_0, a_1), (a_0, a_1)\bigr) \mid a_0 \mathrel{\alpha} a_1 \},
\quad
%% 1_\alpha = \{\bigl((a_0, a_1), (a_0', a_1')\bigr) \mid a_0 \mathrel{\alpha} a_1, \, 
%% a_0' \mathrel{\alpha} a_1' \} = \alpha \times \alpha.
1_\alpha = \{\bigl((u, v), (x, y)\bigr) \mid u \mathrel{\alpha} v, \, 
x \mathrel{\alpha} y \} = \alpha \times \alpha.
\]
%% The latter is simply the cartesian square of $\alpha$,
%% \[
%% \alpha^2 = \{((x, y), (u, v)) \in A^2 \times A^2: x \mathrel{\alpha} y \text{ and } u \mathrel{\alpha} v \}.
%% \]

\noindent For each $\beta \in L$, define the following equivalence relations on $\alpha$:
\[
\beta_0 = \{\bigl((u, v), (x, y)\bigr) \in \alpha\times \alpha \mid u \betar x\}
= \{\bigl((u, v), (x, y)) \mid v\mathrel{\alpha} u \mathrel{\beta} x \mathrel{\alpha} y\};
\]
\[
\beta_1 = \{\bigl((u, v), (x, y)\bigr) \in \alpha\times \alpha \mid v \betar y\}
= \{\bigl((u, v), (x, y)\bigr) \mid u\mathrel{\alpha} v \mathrel{\beta} y \mathrel{\alpha} x\}.
\]
We make the following important exception to these notational conventions:
when it comes to the least equivalence relation, $0_A = \{(a,a)\mid a\in A\}$,
instead of writing $(0_A)_0$ and $(0_A)_1$ for the first and second projection kernels,
we will denote these realtions by $\eta_0$ and $\eta_1$, respectively; that is, 
\[
\eta_0 = \{ \bigl((u, v), (x, y)\bigr) \in \alpha \times \alpha \mid u = x\} = 
\{ \bigl((u,v), (x,y)\bigr) \mid v \mathrel{\alpha} u = x \mathrel{\alpha} y\};
\]
\[
\eta_1 = \{ \bigl((u, v), (x, y)\bigr) \in \alpha \times \alpha \mid v = y\} = 
\{ \bigl((u, v), (x, y)\bigr) \mid u \mathrel{\alpha} v = y \mathrel{\alpha} x\}.
\]

Notice that $\alpha_0 = \alpha_1$ since
%% \begin{align*}
%% \alpha_0 &= \{((x,y), (u,v)) \in \alpha^2 : (x, u) \in \alpha\}\\
%% &= \{((x,y), (u,v)) : y \mathrel{\alpha} x \mathrel{\alpha} u \mathrel{\alpha} v\}\\
%% & = \{((x,y), (u,v)) : x \mathrel{\alpha} y \mathrel{\alpha} v \mathrel{\alpha} u\} = \alpha_1.
%% \end{align*}
\[
\alpha_0  
= \{\bigl((u,v), (x,y)\bigr) \mid v \mathrel{\alpha} u \mathrel{\alpha} x \mathrel{\alpha} y\}
 = \{\bigl((u,v), (x,y)\bigr) \mid u \mathrel{\alpha} v \mathrel{\alpha} y \mathrel{\alpha} x\} = \alpha_1.
\]
In fact, for each $\gamma \geq \alpha$ we have  $\gamma_0 = \gamma_1$. Indeed,
\begin{align*}
\gamma_0 &= \{\bigl((u,v), (x,y)\bigr) \in \alpha\times \alpha \mid u \gammar x\}
= \{\bigl((u,v), (x,y)\bigr) \mid y \alphar x \gammar u \alphar v\}\\
&= \{\bigl((u,v), (x,y)\bigr) \in \alpha \times \alpha \mid v \gammar u \gammar x \gammar y\} 
\qquad \text{(assuming $\gamma \geq \alpha$)}\\
& = \{\bigl((u,v),(x,y)\bigr) \in \alpha\times \alpha \mid v \gammar y \} = \gamma_1.
\end{align*}

\medskip

\noindent Let $\alg{K}_\alpha$ be the sublattice of $\Eq(\alpha)$ generated by the set 
$X = \{\beta_i \mid \beta \in L, i = 0, 1\}$.
%% of all such $\beta_i$'s.
In $X$ there is a pair $\beta_0$, $\beta_1$ for each $\beta \in L$.

\begin{figure}[h!]
  \centering
{\scalefont{1}
\begin{tikzpicture}[scale=0.5]
  \node (eta0) at (-4,0) [fill,circle,inner sep=1.2pt] {};
  \node (eta1) at (4,0) [fill,circle,inner sep=1.2pt] {};
  \node (alpha2) at (0,3) [fill,circle,inner sep=1.2pt] {};
  \node (1) at (0,6) [fill,circle,inner sep=1.2pt] {};
  \node (K0) at (-4,3) [fill,circle,inner sep=1.2pt] {};
  \node (K1) at (4,3) [fill,circle,inner sep=1.2pt] {};
  \node (0) at (0,-3) [fill,circle,inner sep=1.2pt] {};
%\draw (eta0) node [left] {$\eta_0$};
\draw (eta0) node [left] {$\eta_0$};
%\draw (eta1) node [right] {$\eta_1$};
\draw (eta1) node [right] {$\eta_1$};
\draw (K0) node [left] {$\beta_0$};
\draw (K1) node [right] {$\beta_1$};
\draw (1) node [above] {$1_\alpha$};
\draw (0) node [below] {$0_\alpha$};
\draw (alpha2) node [below] {$\alpha_0 = \alpha_1$};

\draw[dotted]
  (eta0) to (K0) to (1) to (K1) to (eta1);
\draw[dotted]
  (alpha2) to (1);
\draw[dotted]
  (0) to (eta0) to (alpha2) to (eta1) to (0);

\end{tikzpicture}
}
\caption{Some relations in the lattice $\Eq(\alpha)$.}
\label{fig:1}
\end{figure}


\medskip


\begin{prop}
Let $\alg{A}$ be a finite algebra with
congruence lattice $\alg{L}$, and let $\alpha \in L$.
In the sublattice $\alg{K}_\alpha \leq \Eq(\alpha)$ described above, 
the intervals $\lb \eta_0, 1_\alpha\rb$ and
$\lb \eta_1, 1_\alpha\rb$ are isomorphic to $\alg{L}$.
\end{prop}

\begin{proof}
Let $\alg{A}$ be an algebra on $A$ with congruence
lattice $\alg{L}$. 
Recall that $\alg{L} = \Eq(A) \cap \Sub(\alg{A}^2)$, so each $\alpha\in L$ is, in
particular, a subalgebra of $\alg{A}^2$.  

Fix $\alpha \in L$, and define the function
$\varphi:\alpha \rightarrow A$ by $\varphi((x, y)) = x$, for all 
$(x,y) \in \alpha$. Then, $\varphi$ is clearly an epimorphism from $\balpha$ to
$\alg{A}$ with kernel $\eta_0$, so the correspondence theorem yields
$\operatorname{Con}(\balpha/\eta_0) \cong \alg{L}$.
Finally, note that $\operatorname{Con}(\balpha/\eta_0)$ is precisely the interval
above $\eta_0$ in the sublattice $\alg{K}_\alpha$ of $\Eq(\alpha)$.
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% end include

% \section{Other potentially useful observations}

%-------------------------------------------------
\renewcommand\bx{\ensuremath{x}}
\renewcommand\by{\ensuremath{y}}
%-------------------------------------------------
\subsection{A special case}
Let $\bA$ be a finite idempotent algebra, let $\sV = \bbV(\bA)$, and let
\[\bF= \bF_{\sV}(\bx,\by) \sdp \bA_0 \times \bA_1 \times \cdots \times \bA_{n-1},\]
where $n \leq |A|^2$ and each $\bA_i$ is a 2-generated subalgebra of $\bA$.
Let $\bR = \Sg^{\bF^2} \{(\bx, \bx), (\bx, \by), (\by, \by)\}$,
and recall that $\bR$ is a subdirect product of $\bF \times \bF$.

Let's see what we can prove under the following
simplifying assumptions:
\begin{enumerate}
\item Assume $\bF \sdp \bA_0 \times \bA_1 \times \bA_2$,
\item For each $i\in \{0,1,2\}$ assume $\bA_i = \Sg^{\bA}(a_i, b_i)$ where
  $\bx = (a_0,a_1,a_2)$ and $\by = (b_0,b_1,b_2)$ are the generators of $\bF$.
\item Let $d$ be a difference term operation when interpreted in
  each of the following algebras:
\begin{enumerate}
  \item \label{item:13} $\bA_i$ for each $i\in \{0,1,2\}$;
  \item \label{item:14}$\bA_i\times \bA_j$ for all $i \neq j$ in $\{0,1,2\}$;
  \item \label{item:15} $\bA_0\times \bA_1 \times \bA_2$.
\end{enumerate}
\end{enumerate}

Recall from Lemma~\ref{lem:preliminary-facts}~(\ref{item:1}) that
$\Cg^{\bF}(\bx, \by) = F\times F = 1_F$ and
$\Cg^{\bA_i}(a_i, b_i) = A_i \times A_i = 1_{A_i}$.
It's clear that $d^{\bF}$ satisfies the strong difference term identity, so 
our goal is to prove that $d^{\bF}$ also satisfies the weak difference term relation,
\begin{equation}
  \label{eq:3}  
  d^{\bF}(\bx, \by, \by) \comr{1_F} \bx.
\end{equation}
This is equivalent to $d^{\bA_0\times \bA_1 \times \bA_2}\bigl((a_0, a_1, a_2), (b_0, b_1, b_2), (b_0, b_1, b_2)\bigr) \comr{1_{F}} (a_0, a_1, a_2)$.
Equivalently, %to prove (\ref{eq:3}) we must show
\begin{equation*}
\bigl(d^{\bA_0}(a_0, b_0, b_0), d^{\bA_1}(a_1, b_1, b_1), d^{\bA_2}(a_2, b_2, b_2)\bigr)
 \comr{1_F} (a_0, a_1, a_2).
\end{equation*}
Assumption~(\ref{item:15}) says
$d^{\bA_0\times \bA_1 \times \bA_2}$ is a difference term operation for 
$\bA_0\times \bA_1 \times \bA_2$, so
\begin{equation}
    \label{eq:5}
  d^{\bA_0\times \bA_1 \times \bA_2}\bigl((a_0, a_1, a_2), (b_0, b_1, b_2), (b_0, b_1, b_2)\bigr)
  \comr{1_{A_0\times A_1\times A_2}} (a_0, a_1, a_2).
\end{equation}
Observe that~(\ref{eq:3}) is still stronger than~(\ref{eq:5})
because $\bF$ is a subalgebra of $\bA_0\times \bA_1 \times \bA_2$, so 
$F \times F = 1_F$ is a subuniverse of
$(\bA_0 \times \bA_1 \times \bA_2)^2$.  The latter has universe
$1_{A_0 \times A_1 \times A_2}$, so
$1_F \subseteq 1_{A_0 \times A_1 \times A_2}$, so by monotonicity of the commutator,
$\com{1_F} \subseteq \com{1_{A_0\times A_1\times A_2}}$ holds.

Our goal is to prove~(\ref{eq:3}), namely,
  $d^{\bF}(\bx, \by, \by) \comr{1_F} \bx$. 
To do so, we will exploit a well-known alternative description of the commutator.
Let $\Tol(A)$ denote the collection of all tolerances (reflexive symmetric relations)
on the set $A$,\footnote{Actually, a
  \emph{tolerance} of an algebra $\bA = \<A, \dots\>$
  is a reflexive symmetric subalgebra of $\bA \times \bA$.
  Therefore, the set of all tolerances of $\bA$ forms an
  algebraic (hence complete) lattice.
  If we drop the operations and consider only the set $A$, then a tolerance relation on $A$
  is simply a reflexive symmetric binary relation.
}
and let 
$\Psi_{\beta, \alpha} \colon \Tol(A) \to \Tol(A)$ be the function defined
for each $T \in  \Tol(A)$ follows:
\begin{equation}
  % \label{eq:7}
  \Psi_{\beta, \alpha}(T)
  = \{ (x,y) \in A\times A \mid
  (\exists\, (a,b) \in T)\,
 (a,b) \mathrel{\Delta_{\beta, \alpha}} (x,y)\},
\end{equation}
where
$\Delta_{\beta, \alpha} = \Cg^{\bbeta}(D_\alpha)$ and
$D_\alpha =(\alpha \mytimes \alpha) \cap (0_A \times 0_A)$.
It can be shown that $\Psiba$ is a closure operator with fixed point 
$\comm{\alpha}{\beta}$, and this leads to the following simple description of
the commutator:
  \begin{align*}
    %% \label{eq:55}
          [\alpha, \beta] =
          \Psiba(0_A)
          &= \{ (x,y) \in A\times A \mid
          (\exists\, (a,b) \in 0_A)\, (a,b) \mathrel{\Delta_{\beta, \alpha}} (x,y)\}\\
          &= \{ (x,y) \in A\times A \mid
          (\exists a \in A)\, (a,a) \mathrel{\Delta_{\beta, \alpha}} (x,y)\}.
  \end{align*}

In the present context, $\bbeta$ is 
$1_F$, the universe of the algebra $\bF\times \bF$.
Let %% $D = \{(x,x) \mid x\in F\}$ and 
\[
D = \{(x,x) \mid x\in F\}, \quad
D_{1_F} = \{\bigl((a,a), (b,b)\bigr) \in D^2 \mid a, b \in F\}, \quad
\Delta = \Delta_{1_F, 1_F} = \Cg^{\bF^2}(D_{1_F}). %= \Cg^{\bF^2}(D^2).  
\]
%% \begin{align*}
%% \nonumber D &= \{(x,x) \mid x\in F\}\\
%%   \nonumber D^2_{1_F} &= \{\bigl((a,a), (b,b)\bigr) \in D^2 \mid a, b \in F\}
%% \text{ and }\\
%% %  = D\times D, \text{ and }\\
%% \nonumber \Delta &= \Delta_{1_F, 1_F} = \Cg^{\bF^2}(D_{1_F}^2). %= \Cg^{\bF^2}(D^2).  
%% \end{align*}
%% \[
%%   D^2_{1_F} := \{\bigl((a,a), (b,b)\bigr) \in D^2 \mid a, b \in F\}
%% \quad \text{ and }\quad 
%% \Delta := \Delta_{1_F, 1_F} = \Cg^{\bF^2}(D_{1_F}^2). %= \Cg^{\bF^2}(D^2).  
%% \]
Then $D_{1_F} = D\times D$, so $\Delta = \Cg^{\bF^2}(D\times D)$.
%% That is, here $D^2_{1_F}$ is simply the square of the diagonal set, that is, 
%% \begin{equation*}
%%   %% \label{eq:10}
%%   D^2_{1_F}  =  D\times D = \{\bigl((x,x), (y,y)\bigr) \mid x, y \in F\}.
%% \end{equation*}

By Lemma~\ref{lem:diagonal-cong-class},
$\bF$ is abelian iff $\Con(\bF\times \bF)$
contains a congruence
%% there is a congruence $\theta \in \Con(\bF\times \bF)$
that has the diagonal set $D$ as a class.
For example, suppose for all $a$, $b$, $b'\in F$ that 
%% $\bigl((a,a), (b,b')\bigr) \in \Delta$ iff
$(a,a)\mathrel{\Delta} (b,b')$ iff $b = b'$.
Then $D$ is a class of $\Delta$ and $\bF$ is abelian.
In that case, $\bF$ is absorption free
(see Lemma~\ref{lem:abelian-AF}) and the Absorption Theorem implies
$\bR  = \bF \times \bF$.
Our earlier goal~(\ref{eq:001}) is
trivially satisfied in this case. Therefore, we proceed under the assumption that $\bF$ is
nonabelian, or equivalently, that no congruence of $\bF^2$ has a class that is
exactly the diagonal set, $D = \{(x,x) \mid x\in F\}$.

Let $\Phi \colon \sP(F \times F) \to \sP(F\times F)$ be the function that
takes each $B \subseteq F\times F$ to
\begin{equation}
  \label{eq:666}
  \Phi(B) = \bigcup_{(b,b')\in B} (b,b')/\Delta
\end{equation}
We now prove that
$\bigl(d^{\bF}(\bx, \by, \by), \bx \bigr) \in  \Phi \com{1_F}$.
This will complete the proof of (\ref{eq:3}), since
$\Phi \com{1_F} \subseteq \com{1_F}$.
 % byLemma~\ref{lem:fixed-point-comm}.
By (\ref{eq:666}), 
$(d^{\bF}(\bx, \by, \by), \bx ) \in  \Phi \com{1_F}$ iff
$(d^{\bF}(\bx, \by, \by), \bx ) \mathrel{\Delta} (b, b')$
for some $(b, b') \in \com{1_F}$.
%-------------------------------------------------
\renewcommand\bx{\ensuremath{\mathbf{x}}}
\renewcommand\by{\ensuremath{\mathbf{y}}}
%-------------------------------------------------

\medskip
To be continued...

\subsection{Observation about commutator in subalgebras}
~

\noindent By assumption~(\ref{item:13}) above, 
$d^{\bA_i}(a_i, b_i, b_i) \comr{1_{A_i}} a_i$ for
each $i \in \{0,1,2\}$, so
\begin{equation*}
  % \label{eq:4}
\bigl(d^{\bA_0}(a_0, b_0, b_0), d^{\bA_1}(a_1, b_1, b_1), d^{\bA_2}(a_2, b_2, b_2)\bigr)
 \mathrel{\com{1_{A_0}} \mytimes  \com{1_{A_1}} \mytimes \com{1_{A_2}}} (a_0, a_1, a_2),
\end{equation*}
but we can do better.
Indeed, by assumption~(\ref{item:14}),
\[
\bigl(d^{\bA_i}(a_i, b_i, b_i), d^{\bA_j}(a_j, b_j, b_j)\bigr)
=d^{\bA_i\times \bA_j}\bigl((a_i, a_j), (b_i,b_j), (b_i, b_j)\bigr)
\comr{1_{A_i\times A_j}} (a_i, a_j)
\]
for all $i\neq j$ in $\{0,1,2\}$.
Combining this with assumption~(\ref{item:13}) we have
\[
\bigl(d^{\bA_0\times \bA_1}((a_0, a_1), (b_0,b_1), (b_0, b_1)),
d^{\bA_2}(a_2, b_2,b_2)\bigr)
\mathrel{\com{1_{A_0\times A_1}} \mytimes \com{1_{A_2}}}
\bigl((a_0, a_1),a_2\bigr).
\]
and 
\[
\bigl(d^{\bA_0}(a_0, b_0, b_0), d^{\bA_1\times \bA_2}((a_1, a_2), (b_1,b_2), (b_1, b_2))\bigr)
\mathrel{\com{1_{A_0}} \mytimes \com{1_{A_1\times A_2}}} \bigl(a_0, (a_1, a_2)\bigr).
\]
This is an improvement, % improves upon~(\ref{eq:4}), 
but we still haven't made full use of our assumptions.
Indeed,~(\ref{item:15}) says
$d^{\bA_0\times \bA_1 \times \bA_2}$ is a difference term operation for 
$\bA_0\times \bA_1 \times \bA_2$, so
\begin{equation}
    \label{eq:555}
  d^{\bA_0\times \bA_1 \times \bA_2}\bigl((a_0, a_1, a_2), (b_0, b_1, b_2), (b_0, b_1, b_2)\bigr)
  \comr{1_{A_0\times A_1\times A_2}} (a_0, a_1, a_2).
\end{equation}
Observe that~(\ref{eq:3}) is still stronger than~(\ref{eq:555})
because $\bF$ is a subalgebra of $\bA_0\times \bA_1 \times \bA_2$, so 
$F \times F = 1_F$ is a subuniverse of
$(\bA_0 \times \bA_1 \times \bA_2)^2$.  The latter has universe
$1_{A_0 \times A_1 \times A_2}$, so
$1_F \subseteq 1_{A_0 \times A_1 \times A_2}$, so by monotonicity of the commutator,
$\com{1_F} \subseteq \com{1_{A_0\times A_1\times A_2}}$ holds.
\\[4pt]
{\bf Question.} How do the following congruence relations compare?
\begin{enumerate}
\item $\com{1_{A_0}} \mytimes \com{1_{A_1\times A_2}}$
\item $\com{1_{A_0\times A_1}} \mytimes \com{1_{A_2}}$
\item $\com{1_{A_0\times A_1\times A_2}}$
\item $\com{1_F}$
\end{enumerate}

\medskip

\[
\Com{1_{A_0}} \mytimes \Com{1_{A_1\times A_2}} = 
\{(\bx, \by) \mid x_0 \Comr{1_{A_0}} y_0 \, \text{ and } \, 
(x_1, x_2) \Comr{1_{A_1\times A_2}} (y_1, y_2)\}.
\]
\[
\Com{1_{A_0\times A_1}} \mytimes\Com{1_{A_2}} = 
\{(\bx, \by) \mid  
(x_0, x_1) \Comr{1_{A_0\times A_1}} (y_0, y_1)\, \text{ and } \, x_2 \Comr{1_{A_2}} y_2 
\}.
\]

\bigskip
%% The relation $\com{1_{A_0}} \times \com{1_{A_1\times A_2}}$ has elements 
%% \{((x_0, x_1, x_2), (y_0, y_1, y_2))  \mid x_0 \comr{1_{A_0}} y_0 \; \text{ and } \; 
%% (x_1, x_2) \comr{1_{A_1\times A_2}} (y_1, y_2)\}.
%% \[
%% \com{1_{A_0}} \times \com{1_{A_1\times A_2}} = 
%% \{(\bx, \by) \mid x_0 \comr{1_{A_0}} y_0 \, \text{ and } \, 
%% (x_1, x_2) \comr{1_{A_1\times A_2}} (y_1, y_2)\}.
%% \]
%% \[
%% \com{1_{A_0\times A_1}} \times\com{1_{A_2}} = 
%% \{(\bx, \by) \mid  
%% (x_0, x_1) \comr{1_{A_0\times A_1}} (y_0, y_1)\, \text{ and } \, x_2 \comr{1_{A_2}} y_2 
%% \}.
%% \]




\bigskip
\subsection{Other potentially useful observations}
A very useful result of Kearnes and Kiss that holds in varieties that satisfy a
nontrivial idempotent \malcev condition is the following:
\begin{theorem}[\protect{\cite[Thm~3.27]{MR3076179}}] 
  \label{thm:kearnes-kiss-3.27}
  Suppose $\alpha$ and $\beta$ are congruences of a Taylor algebra. Then
  $\CC{\alpha}{ \alpha}{ \alpha \meet \beta}$ if and only if
  $\CC{\alpha \join \beta}{ \alpha \join \beta}{ \beta}$.
\end{theorem}

\subsection*{Observation 1}
That $\bR/\rho_1 \cong \bFone /[1_{\Fone},1_{\Fone}]$ is abelian means
$\CC{1_{R/\rho_1}}{1_{R/\rho_1}}{0_{R/\rho_1}}$ holds, and this is equivalent to
$\CC{1_R}{1_R}{\rho_1}$. By Theorem~\ref{thm:kearnes-kiss-3.27} below, the latter
holds if and only if $\CC{\etaR_0}{\etaR_0}{\etaR_0\meet \rho_1}$.
It follows that $[\etaR_0, \etaR_0]\leq \etaR_0 \meet \rho_1$.



\subsection*{Observation 2}
\renewcommand{\phi}{\ensuremath{\varphi}}
For each $i\in \{0,1,2\}$, let $\etaR_i = \ker(\bF \onto \bA_i)$ be the kernel of
the projection of $\bF$ onto the $i$-th coordinate.  Then
$\bF/\etaR_i \cong \bA_i$ and by the correspondence theorem there exists
$\phi_i\in \Con\bF$ corresponding to $\com{1_{A_i}} \in \Con \bA_i$
such that 
\[
\bF/\phi_i \cong
\bigl(\bF/\etaR_i\bigr)\bigl(\phi_i/\etaR_i\bigr)
\cong \bA_i/\com{1_{A_i}}.
\]

\bigskip

\subsection{Skew congruences of idempotent algebras}
Let $\sV$ be a variety and let $\bA$ and $\bB$ be idempotent
algebras in $\sV$.
Recall the following standard notation:
if $\alpha \in \Con(\bA)$ and $\beta \in \Con(\bB)$, then
$\alpha \mytimes \beta$ denotes the set of pairs $((a,b),(a',b'))$ satisfying
$a \mathrel{\alpha} a'$ and $b \mathrel{\beta} b'$.  The relation 
$\alpha \mytimes \beta$ is clearly a congruence of $\bA \times \bB$.

Fix $(a, b)$ and $(a', b')$ in $A \times B$, and consider the claim 
\begin{equation}
  \label{eq:999}
\Cg^{\bA}(a,a') \mytimes \Cg^{\bB}(b,b')
=\Cg^{\bA \times \bB}((a, b), (a', b')).
\end{equation}

Let $\tau := \Cg^{\bA}(a,a') \mytimes \Cg^{\bB}(b,b')$  %%  \in \Con(\bA \times \bB)$
and $\theta:= \Cg^{\bA \times \bB}((a, b), (a', b'))$.
First note that $\tau$ is a (pairwise) product of a congruence
of $\bA$ with a congruence of $\bB$, so $\tau$ is a congruence of $\bA\times \bB$.
Moreover, the pair $((a,b), (a',b'))$ clearly belongs to $\tau$, so
$\theta\leq \tau$.  Thus, to prove~(\ref{eq:999}) it would suffice to show $\tau \leq \theta$.

Fix $((x,y),(x'y')) \in \tau$. This means that
$(x,x') \in \Cg^{\bA}(a,a')$ and $(y,y')\in \Cg^{\bB}(b,b')$.
Therefore, there exist $n>0$, $m>0$, 
%% $(c_0, c_0'), (c_1, c_1'), \dots, (c_n, c_n')$ in $,  
$c_0$, $c_1$, $\dots$, $c_n$ $\in A$, $f_0$, $f_1$, $\dots$,
$f_{n-1} \in \Pol_1(\bA)$, $d_0$, $d_1$, $\dots$, $d_n\in B$, and $g_0$, $g_1$, $\dots$,
$g_{n-1} \in \Pol_1(\bB)$ such that 
\begin{align*}
  x = c_0, \; c_n=x', \text{ and } \; \{c_i, c_{i+1}\} &= \{f_i(a), f_i(a')\},
  \text{ for all $0\leq i < n$, and}\\
  y = d_0, \; d_n=y',  \text{ and }  
  \{d_i, d_{i+1}\} &= \{g_i(b), g_i(b')\}, \text{ for all $0\leq i < m$.}
\end{align*}
We can assume without loss of generality that $n=m$, since we can insert dummy
terms to extend the shorter of the two sequences.
We wish to prove $((x,y),(x'y')) \in \theta:= \Cg^{\bA \times \bB}((a, b), (a', b'))$,
which is equivalent to the following: there exist $n>0$, 
$(e_0, e_0')$, $(e_1,e_1')$, $\dots$, $(e_n, e_n') \in A\times B$, 
$h_0$, $h_1$, $\dots$, $h_{n-1} \in \Pol_1(\bA\times \bB)$ such that
\begin{align*}
  (x,y) = (e_0,e_0'), \; (e_n, e_n') &=(x',y'), \text{ and for all $0\leq i < n$, } \\
  \{(e_i, e_i'), (e_{i+1}, e_{i+1}')\} &= \{h_i(a,b), h_i(a',b')\}.
\end{align*}


Let $f = f_0$.  Since $f\in \Pol_1(\bA)$, for some $\ell>0$ there
exist a term $s^{\bA} \in \Clo_{\ell+1}(\bA)$ and $a_0, a_1, \dots, a_\ell$ in $A$ such that
\[
f^{\bA}(x) = s^{\bA}(a_0, \dots, a_{i-1}, x, a_{i+1}, \dots, a_\ell), \text{ for some $i$.}
\]
Similarly, letting $g = g_0$, for some $k>0$ there
exist a term $t^{\bB} \in \Clo_{k+1}(\bB)$ and $b_0, b_1, \dots, b_k$ in $B$ such that
\[
g^{\bB}(y) = t^{\bB}(b_0, \dots, b_{j-1}, y, b_{j+1}, \dots, b_k), \text{ for some $j$.}
\]
Without loss of generality, we can assume $j=i$. (check this)

%% Now, for
%% $\ba  = (a_0, a_1, \dots, a_{\ell})\in A^{\ell+1}$ and
%% $\bb  = (b_0, b_1, \dots, b_{\ell})\in B^{\ell+1}$, we have
%% \[
%% s^{\bA \times \bB}((a_0, b_0), \dots, (a_{\ell}, b_{\ell}))
%% = (s^{\bA}(\ba), s^{\bB}(\bb)).
%% \]
Consider the polynomial $p \in \Pol_1(\bA\times \bB)$ defined via
$s$ as follows:
\begin{align*}
p(x,y) &= s^{\bA \times \bB}((a_0, b), (a_1, b), \dots, (a_{i-1}, b),(x,y),
(a_{i+1}, b), \dots, (a_{\ell}, b))\\
&= (s^{\bA} (a_0, a_1,\dots, a_{i-1}, x, a_{i+1}, \dots, a_{\ell}), 
s^{\bB}(b, \dots, b, y, b,\dots, b))\\
&= (f^{\bA} (x), 
s^{\bB}(b, \dots, b, y, b,\dots, b)).
\end{align*}
Consider the polynomial $q \in \Pol_1(\bA\times \bB)$ defined via
$t$ as follows:
\begin{align*}
q(x,y) &= t^{\bA \times \bB}((f^{\bA}(a), b_0), (f^{\bA}(a), b_1), \dots, (f^{\bA}(a), b_{i-1}),(x,y),
(f^{\bA}(a), b_{i+1}), \dots, (f^{\bA}(a), b_{\ell}))\\
&= (t^{\bA} (f^{\bA}(a), \dots, f^{\bA}(a), x, f^{\bA}(a), \dots, f^{\bA}(a)), 
t^{\bB}(b_0, \dots, b_{i-1}, y, b_{i+1},\dots, b_{\ell}))\\
&= (t^{\bA} (f^{\bA}(a), \dots, f^{\bA}(a), x, f^{\bA}(a), \dots, f^{\bA}(a)), 
g^{\bB}(y)).
\end{align*}
Then $p(a,b) = (f^{\bA}(a), b)$ and $q(f^{\bA}(a), b) = (f^{\bA}(a),g^{\bB}(b))$.
Therefore,
\[
(q\circ p)^{\bA\times \bB} (a,b) =
(f^{\bA} (a), g^{\bB} (b)).
\]
We can carry out this construction for each pair $(f_i, g_i)$, $0\leq i < n$,
arriving at a sequence $q_i \circ p_i$ of polynomials in
$\Pol_1(\bA \times \bB)$ such that
\[
(q_i\circ p_i)^{\bA\times \bB} (a,b) =
(f_i^{\bA} (a), g_i^{\bB} (b)).
\]
Unfortunately, evaluating this polynomial at $(a',b')$ yields the less
desirable result:
\[
(q_i\circ p_i)(a',b')=
(t_i^{\bA}(f_i^{\bA} (a), \dots, f_i^{\bA} (a), f_i^{\bA} (a'),f_i^{\bA} (a), \dots, f_i^{\bA} (a)),
g_i(s_i^{\bB}(b, \dots, b, b', b,\dots, b))).
\]
So we try again...

\bigskip
%% \[
%% d_i(x,y) = d^{\bA\times \bB}((a_i,b),(a_i,b),(a_i,y)) = (d^{\bA}(a_i,a_i,a_i),
%% d^{\bB}(b,b,y)) = (a_i, d^{\bB}(b,b,y))
%% \]
Consider the polynomial $p \in \Pol_1(\bA\times \bB)$ defined via
$s$ as follows:
\begin{align*}
p(x,y) &= s^{\bA \times \bB}((a_0, y), \dots, (a_{i-1}, y), (x, y), (a_{i+1}, y), \dots, (a_{\ell}, y))\\
&= (s^{\bA} (a_0, \dots, a_{i-1}, x, a_{i+1}, \dots, a_{\ell}), 
s^{\bB}(y, \dots, y))\\
&= (f^{\bA} (x), y).
\end{align*}
Consider the polynomial $q \in \Pol_1(\bA\times \bB)$ defined via
$t$ as follows:
\begin{align*}
  q(x,y) &= t^{\bA \times \bB}(p(x,b_0),
  \dots, p(x, b_{i-1}),p(x,y),
  p(x, b_{i+1}), \dots, p(x, b_{\ell}))\\
  &= t^{\bA \times \bB}((f^{\bA}(x), b_0), \dots, (f^{\bA}(x), b_{i-1}),(f^{\bA}(x),y),
(f^{\bA}(x), b_{i+1}), \dots, (f^{\bA}(x), b_{\ell}))\\
%% &= (t^{\bA} (f^{\bA}(x), \dots, f^{\bA}(x), x, f^{\bA}(x), \dots, f^{\bA}(x)), 
%% g^{\bB}(y)).
&= (f^{\bA}(x), g^{\bB}(y)).
\end{align*}
Then $p(a,b) = (f^{\bA}(a), b)$ and $q(f^{\bA}(a), b) = (f^{\bA}(a),g^{\bB}(b))$.
Therefore,
\[
(q\circ p)^{\bA\times \bB} (a,b) =
(f^{\bA} (a), g^{\bB} (b)).
\]
We can carry out this construction for each pair $(f_i, g_i)$, $0\leq i < n$,
arriving at a sequence $q_i \circ p_i$ of polynomials in
$\Pol_1(\bA \times \bB)$ such that
\[
(q_i\circ p_i)^{\bA\times \bB} (a,b) =
(f_i^{\bA} (a), g_i^{\bB} (b)).
\]
% Unfortunately, evaluating this polynomial at $(a',b')$ yields the less
% desirable result:
% \[
% (q_i\circ p_i)(a',b')=
% (t_i^{\bA}(f_i^{\bA} (a), \dots, f_i^{\bA} (a), f_i^{\bA} (a'),f_i^{\bA} (a), \dots, f_i^{\bA} (a)),
% g_i(s_i^{\bB}(b, \dots, b, b', b,\dots, b))).
% \]

% \bigskip

% \hrule

% \bigskip

% \begin{align*}
%   f^{\bB}(y) &= s^{\bB}(d(b,b,y), \dots, d(b,b,y), y, d(b,b,y), \dots, d(b,b,y)), \; \text{ and }\\
%   g^{\bA}(x) &= t^{\bA}(f^{\bA}(a), \dots, f^{\bA}(a), x, f^{\bA}(a), \dots, f^{\bA}(a)).
% \end{align*}
% Then
% \[
% f^{\bA\times \bB} (a,b) =
% (f^{\bA} (a), f^{\bB}(b)) = (f^{\bA} (a), s^{\bB}(b, \dots, b, )) = (f^{\bA} (a), b),
% \]
% and 
% \[
% g^{\bA\times \bB} (f^{\bA} (a), b) =
% (g^{\bA} (f^{\bA} (a)), g^{\bB}(b))=
% (t^{\bA}(f^{\bA}(a), \dots, f^{\bA}(a)),g^{\bB}(b))=
% (f^{\bA} (a), g^{\bB} (b)).
% \]
% Therefore,
% \[
% (g^{\bA\times \bB}\circ f^{\bA\times \bB}) (a,b) =
% (f^{\bA} (a), g^{\bB} (b)).
% \]

% But now what happens when we evaluate 
% $(g^{\bA\times \bB}\circ f^{\bA\times \bB}) (a',b')$?
% We have
% \begin{align*}
%   f^{\bA\times \bB} (a',b') &=
%   (f^{\bA} (a'), f^{\bB}(b')) \\&= \bigl(f^{\bA} (a'), s^{\bB}(d(b,b,b'), \dots,
%   d(b,b,b'), b', d(b,b,b'),\dots, d(b,b,b'))\bigr)\\
%   &= \bigl(f^{\bA} (a'), s^{\bB}(b', \dots, b')\bigr)= \bigl(f^{\bA} (a'), b'\bigr).
% \end{align*}

% \newpage
\bigskip
\section{Miscellaneous Theorems}
We collect here the statement and proofs of results that we used above but whose
proofs were omitted from the main body above so as not to iterrupt the flow.


\subsection{Abelian algebras have a congruence with a ``diagonal'' class}
\label{sec:abel-algebr-diag}
\begin{lem}[Lem.~\protect{\ref{lem:diagonal-cong-class}} above]
 An algebra $\bA$ is abelian if and only if there is some 
 $\theta \in \Con (\bA^2)$ that has the diagonal $D(A):= \{(a,a): a \in A\}$ 
 as a congruence class.
\end{lem}
\begin{proof}
($\Leftarrow$) Assume $\Theta$ is such a congruence.  Fix 
  $k<\omega$,
  $t^{\bA}\in \Clo_{k+1}(\bA)$, 
  $u, v \in A$, and
  $\bx, \by \in A^k$.
  We must prove the implication
\begin{equation*}
t^\bA(\bx,u) = t^\bA(\by,u) \quad \Longrightarrow \quad 
t^{\bA}(\bx,v) = t^{\bA}(\by,v).
\end{equation*}
Since $D(A)$ is a class of $\Theta$, we have 
  $(u,u) \mathrel{\Theta} (v,v)$, and since $\Theta$ is a reflexive relation, we have
  $(x_i,y_i)  \mathrel{\Theta} (x_i,y_i)$ for all $i$.  Therefore,
\begin{equation}
  \label{eq:9}  
  t^{\bA\times \bA}((x_1,y_1), \dots, (x_k,y_k), (u,u))
  \mathrel{\Theta}
  t^{\bA\times \bA}((x_1,y_1), \dots, (x_k,y_k), (v,v)).
\end{equation}
  since $t^{\bA \times \bA}$ is a term operation of $\bA\times \bA$.
  Note that~(\ref{eq:9}) is equivalent to
  \begin{equation}
    \label{eq:13}
    (t^{\bA}(\bx, u), t^{\bA}(\by,u))
    \mathrel{\Theta}
    (t^{\bA}(\bx, v), t^{\bA}(\by, v)).
  \end{equation}
  If $t^{\bA}(\bx, u)= t^{\bA}(\by, u)$ then 
  the first pair in~(\ref{eq:13}) belongs to the $\Theta$-class
  $D(A)$, so the second pair must also belong this $\Theta$-class.
  That is, $t^{\bA}(\bx, v)= t^{\bA}(\by, v)$, as desired.

  \vskip2mm

  \noindent ($\Rightarrow$) Assume $\bA$ is abelian. We show
  $\Cg^{\bA^2}(D(A)^2)$ has $D(A)$ as a block.  Assume
  \begin{equation}
    \label{eq:16}
  ((x,x), (c,c')) \in \Cg^{\bA^2}(D(A)^2).
  \end{equation}
  It suffices to prove that $c=c'$.  Recall, \malcev's congruence generation
  theorem states that (\ref{eq:16}) holds iff
  %$(x,x) \theta (c,c') \in \Cg^{\bA^2}(D(A)^2)$ iff %% for $0\leq i \leq n$ and 
  %% $0\leq j \leq n-1$, there exist
  \begin{align*}
  \exists \,& (z_0,z_0'), (z_1,z_1'), \dots, (z_n,z_n') \in A^2\\
    \exists \,& ((x_0,x_0'), (y_0,y_0')), ((x_1,x_1'), (y_1,y_1')), \dots, 
    ((x_{n-1},x_{n-1}'), (y_{n-1},y_{n-1}')) \in D(A)^2\\
    \exists \, & f_0, f_1, \dots, f_{n-1}\in F^*_{\bA^2}
  \end{align*}
  %% \begin{align*}
  %% (z_i,z_i') &\in A^2\\
  %% ((x_j,x_j'), (y_j,y_j')) &\in D(A)^2\\
  %% f_j &\in F^*_{\bA^2}
  %% \end{align*}
  such that 
  \begin{align}
    \label{eq:7}
    \{(x, x),(z_1,z_1')\} &= \{f_0(x_0,x_0'), f_0(y_0,y_0')\}\\
\nonumber
     \{(z_1,z_1'),(z_2,z_2')\} &= \{f_1(x_1,x_1'), f_1(y_1,y_1')\}\\
\nonumber
     & \vdots\\
    \label{eq:8}
     \{(z_{n-1},z_{n-1}'),(c, c')\} &= \{f_{n-1}(x_{n-1},x_{n-1}'), f_{n-1}(y_{n-1},y_{n-1}')\}
 \end{align}
The notation $f_i\in F^*_{\bA^2}$ means 
\begin{align*}
f_i(x, x') &= g_i^{\bA^2}((a_1, a_1'), (a_2, a_2'), \dots, (a_k, a_k'), (x, x'))\\
&= (g_i^{\bA}(a_1, a_2, \dots, a_k, x), g_i^{\bA}(a_1', a_2', \dots, a_k', x')),
\end{align*}
for some $g_i^{\bA} \in \Clo_{k+1}(\bA)$ and some constants 
$\ba = (a_1, \dots, a_k)$ and $\ba' = (a_1', \dots, a_k')$ in $A^k$. 
Now, $((x_i,x_i'), (y_i,y_i'))\in D(A)^2$ implies 
$x_i=x_i'$, and $y_i=y_i'$, so in fact we have 
\[
     \{(z_i,z_i'),(z_{i+1},z_{i+1}')\} = \{f_i(x_i,x_i), f_i(y_i,y_i)\} \quad (0\leq i < n).
\]
Therefore, by Equation~(\ref{eq:7}) we have either 
\[
     (x,x)= (g_i^{\bA}(\ba, x_0), g_i^{\bA}(\ba', x_0)) \quad \text{ or } \quad 
     (x,x)= (g_i^{\bA}(\ba, y_0), g_i^{\bA}(\ba', y_0)).
\]
Thus, either $g_i^{\bA}(\ba, x_0) =  g_i^{\bA}(\ba', x_0)$ %\quad \text{ or } \quad 
or $g_i^{\bA}(\ba, y_0) =  g_i^{\bA}(\ba', y_0)$.
By the abelian assumption, if one of these equations holds, then so does the
other. This and and Equation (\ref{eq:7}) imply $z_1 = z_1'$.  Applying the same
argument inductively, we find that $z_i = z_i'$ for all $1\leq i < n$ and so, by
(\ref{eq:8}) and the abelian property, we have $c= c'$.
\end{proof}


\begin{lemma}
  \label{lem:bijection_abelian}
  Suppose $\rho \colon A_0 \to A_1$ is a bijection and suppose the graph
  $\{(x, \rho x) \mid x \in A_0\}$ is a block of some congruence
  $\beta \in \Con (A_0 \times A_1)$.  Then both $\bA_0$ and $\bA_1$ are abelian.
\end{lemma}
\begin{proof}
  Define the relation $\alpha\subseteq (A_1\times A_1)^2$ as follows: for
  $((a,a'), (b,b')) \in (A_1\times A_1)^2$,
  \[
  (a,a')\mathrel{\alpha} (b,b')
  \quad \iff \quad
  (a, \rho a') \mathrel{\beta} (b, \rho b')
  \]
  We prove that the diagonal $D(A_1)$ is a block of $\alpha$ by showing that
  $(a, a) \mathrel{\alpha} (b,b')$ implies $b = b'$.
  Indeed, if $(a, a) \mathrel{\alpha} (b,b')$, then
  $(a, \rho a) \mathrel{\beta} (b, \rho b')$, which means that
  $(b, \rho b')$ belongs to the block and
  $(a, \rho a)/\beta = \{(x, \rho x)\mid x\in A_1\}$.  Therefore,
  $\rho b  = \rho b'$, so $b = b'$ since $\rho$ is injective.
  This proves that $\bA_1$ is abelian.

  To prove $\bA_2$ is abelian, we reverse the roles of $A_1$ and $A_2$ in the
  foregoing argument.  
  If $\{(x, \rho x) \mid x \in A_1\}$ is a block of $\beta$,
  then 
  $\{(\rho^{-1}(\rho x), \rho x) \mid \rho x \in A_2\}$ is a block of $\beta$; that
  is, $\{(\rho^{-1} y, y) \mid y \in A_2\}$ is a block of $\beta$.  Define 
  the relation $\alpha\subseteq (A_2\times A_2)^2$ as follows: for
  $((a,a'), (b,b')) \in (A_2\times A_2)^2$,
  \[
  (a,a')\mathrel{\alpha} (b,b')
  \quad \iff \quad
  (\rho^{-1}a, \rho a') \mathrel{\beta} (\rho^{-1}b, \rho b').
  \]
  As above, we can prove that the diagonal $D(A_2)$ is a block of $\alpha$
  by using the injectivity of $\rho^{-1}$ to show that $(a, a) \mathrel{\alpha}
  (b,b')$
  implies $b = b'$.
\end{proof}

\bigskip

\subsection{Abelian algebras are absorption free}
\label{sec:proof-that-abelian}
An very useful property of abelian algebras is that they are absorption-free.
A proof of this appears in~\cite[Lem~4.1]{MR3374664}, but we include 
a proof here for easy reference and to keep the paper somewhat self-contained.
First we require an elementary fact about functions on finite sets.

%% \noindent {\bf Fact A.1.}
\begin{fact}
\label{fact:idemp-funct-fin-set}
  If $f\colon X \rightarrow X$ is a (unary) function on a finite set $X$, then there
  is a natural number $k\geq 1$ 
  such that the $k$-fold composition of $f$ with itself
  is the same function as the $2k$-fold composition.  That is, for all 
  $x \in X$, $f^{2k}(x) = f^k(x)$.
\end{fact}

\begin{lem}[Lem.~\protect{\ref{lem:abelian-AF}} above]
Finite idempotent abelian algebras are absorption-free.
\end{lem}
\begin{proof}
  Suppose $\bA$ is a finite idempotent abelian algebra with $\bB \absorbing_t \bA$.
  We show $\bB = \bA$.
  If $t$ is unary, then by idempotence $t$ is the identity function and
  absorption in this case means $t[A] \subseteq B$.  It follows that $A = B$ and
  we're done.  So assume $t$ has arity $k>1$.  We
  will show that there must also be a $(k-1)$-ary term operation 
  $s\in \sansClo(\bA)$ such that $\bB \absorbing_s \bA$.  
  It follows inductively that there must also be a unary absorbing term
  operation. Since a unary idempotent operation is the identity
  function, this will complete the proof.

  Define a sequence of terms $t_0, t_1, \dots$ as follows:
  for each $\bx = (x_1, \dots, x_{k-1}) \in A^{k-1}$ and $y\in A$,
  \begin{align*}
    t_0(\bx, y) &= t(\bx, y),\\
    t_1(\bx, y) &= t(\bx, t_0(\bx, y)) = t(\bx, t(\bx, y)), \\
    t_2(\bx, y) &= t(\bx, t_1(\bx, y)) = t(\bx, t(\bx, t(\bx, y))),\\
     &\vdots\\
    t_m(\bx, y) &= t(\bx, t_{m-1}(\bx, y)) 
                 = t(\bx, \dots, t(\bx, t(\bx, t(\bx, y))) \cdots )).
  \end{align*}
  It is easy to see that $\bB$ is absorbing in $\bA$ with respect to $t_m$, that
  is, $\bB \absorbing_{t_m} \bA$.  

  For each $\bx_i\in A^{k-1}$, 
  define $p_i:A \rightarrow A$ by $p_i(y) = t(\bx_i, y)$.  Then, 
  $p_i^m(y) = t_m(\bx_i, y)$, so by
  Fact~A.1 %% \ref{fact:idemp-funct-fin-set}
  there exists an $m_i\geq 1$ such that 
   $p_i^{2m_i} = p_i^{m_i}$.  That is, 
  $t_{m_i}(\bx_i,t_{m_i}(\bx_i,y)) = t_{m_i}(\bx_i,y)$.
  Let $m$ be the product of all the $m_i$ as $\bx_i$ varies over $A^{k-1}$.
  Then, for all $\bx_i \in A^{k-1}$, we have 
   $p_i^{2m} = p_i^{m}$.  Therefore, 
  for all $\bx \in A^{k-1}$, we have 
  $t_{m}(\bx,t_{m}(\bx,y)) = t_{m}(\bx,y)$.

  We now show that the $(k-1)$-ary term operation $s$, defined for all 
  $x_1, \dots, x_{k-1} \in A$ by 
  \[
  s(x_1, \dots, x_{k-2}, x_{k-1})=
  t(x_1, \dots, x_{k-2}, x_{k-1}, x_{k-1})
  \]
  is absorbing for $\bB$, that is, $\bB \absorbing_{s} \bA$.  It suffices to
  prove that $s[B \times \cdots \times B \times A] \subseteq B$. 
  (For if the factor involving $A$ occurs earlier, we appeal to
  absorption with respect to $t$.)
  So, for $\bb \in B^{k-2}$ and $a\in A$, we will show 
  $s(\bb, a) = t_m(\bb, a,a) \in B$.  For all $b\in B$, we have
  \[
  t_m(\bb, b, a) = t_m(\bb, b, t_m(\bb, b, a)).
  \]
  Therefore, if we apply (at the $(k-1)$-st coordinate) 
  the fact that $\bA$ is abelian, then we have
  \begin{equation}
    \label{eq:14}
    t_m(\bb, a, a) = t_m(\bb, a, t_m(\bb, b, a)).
  \end{equation}
  By absorption, $t_m(\bb, b, a)$ belongs to $B$, thus so does the
  entire expression on the right of~(\ref{eq:14}).  This proves that 
  $s(\bb, a) = t_m(\bb, a,a) \in B$, as desired.
\end{proof}

\begin{comment}
\bigskip
\subsection{Fixed Point Lemma}
\label{sec:fixed-point-lemma}
\begin{lem}[Lem.~\protect{\ref{lem:fixed-point-comm}} above]
  Let $\bA$ be an algebra with $\alpha$, $\beta\in \Con(\bA)$.
  If $\Phi:=\Phi_{\beta, \alpha}$ is defined as in~(\ref{eq:6}), then 
  \begin{enumerate}[(i)]
  \item \label{item:001} $\Phiba$ is a closure operator on $\sP(\beta)$;
  \item \label{item:002} $[\alpha, \beta]$ is the least fixed point of $\Phiba$.
  \end{enumerate}
\end{lem}
\begin{proof}\
  %% \begin{enumerate}[(i)]
  %% \item 
\noindent (i) Fix $B \subseteq \beta$. We must prove the following:
    (a) $B \subseteq \Phiba(B)$;    
    (b) $B \subseteq C  \Rightarrow \Phiba(B) \subseteq \Phiba(C)$;    
    and (c) $\Phiba(\Phiba(B))  = \Phiba(B)$.    
    If $(b,b') \in B$, then $(b,b') \in \Phiba(B)$ since the
    operation~(\ref{eq:6}) does not discard any of the pairs that were already in $B$.
    %% Thus, $G \subseteq \Phiba(G)$ proving~(\ref{item:1}).
    As for (b), if $(a,a') \in \Phiba(B)$, then there exists
    $(b,b') \in B \subseteq C$ such that $(a,a') \mathrel{\Delta_{\beta, \alpha}} (b,b')$.
    Since $(b,b')$ belongs to $C$ we have $(a,a') \in \Phiba(C)$ as well.
    As for (c), it clearly follows from
    (a) and (b) that $\Phiba(B)\subseteq \Phiba(\Phiba(B))$, so we prove the
    reverse inclusion.    
    Let $(d,d') \in \Phiba(\Phiba(B))$. Then
    $(c,c') \mathrel{\Delta_{\beta, \alpha}} (d,d')$ for some
    $(c,c') \in \Phiba(B)$, which implies
    $(b,b') \mathrel{\Delta_{\beta, \alpha}} (c,c')$ for some
    $(b,b') \in B$.  By transitivity of $\Delta_{\beta, \alpha}$ we conclude that
    $(d,d') \in \Phiba(B)$, as desired.
    \bigskip

\noindent (ii)
Since $[\alpha, \beta] \in \sP(\beta)$
we have $[\alpha, \beta] \subseteq \Phiba([\alpha, \beta])$,
by~(\ref{item:1}).
    We prove the reverse inclusion.
    %% $\Phiba([\alpha, \beta]) \subseteq [\alpha, \beta]$.
    If $(c,c')\in \Phiba([\alpha, \beta])$, then~(\ref{eq:6})
    implies there exists $(b,b')\in [\alpha, \beta]$ such that
    \begin{equation}
      \label{eq:1000}
      (b,b') \mathrel{\Delta_{\beta, \alpha}} (c,c').
    \end{equation}
    From the definition of $\Delta_{\beta, \alpha}$ and 
    \malcev's theorem on congruence generation,~(\ref{eq:1000})
    holds if and only if
    %% \begin{align*}
    %%   \exists \,& z_i \betar z_i', \quad 0\leq i \leq n,\\
    %%   \exists \,& x_i \alphar y_i, \quad  0\leq i < n,\\
    %%   \exists\, &f_i \in F_{\bA^2}^\ast, \quad 0\leq i < n,
    %% \end{align*}
    $\exists \, z_i \betar z_i'$ $(0\leq i \leq n)$,
    $\exists \, x_i \alphar y_i$ $(0\leq i < n)$,
    $\exists\, f_i \in \Pol_1(\bA\times \bA)$ $(0\leq i < n)$
    such that
    $(b, b') = (z_0,z_0')$ and
    $(z_n,z_n') = (c, c')$, and
    \begin{align}
      \label{eq:0}
      \{(b, b'),(z_1,z_1')\} &= \{f_0(x_0,x_0), f_0(y_0,y_0)\}\\
      \label{eq:1}
      \{(z_1,z_1'),(z_2,z_2')\} &= \{f_1(x_1,x_1), f_1(y_1,y_1)\}\\
      \nonumber
      & \vdots\\
      %% \label{eq:n-1}
      \nonumber
      \{(z_{n-1},z_{n-1}'),(c, c')\} &= \{f_{n-1}(x_{n-1},x_{n-1}), f_{n-1}(y_{n-1},y_{n-1})\}
    \end{align}
    For each $(0\leq i < n)$, $f_i \in \Pol_1(\bA\times \bA)$, which means
    \newcommand\gA{\ensuremath{g^{\bA}}}%
    %% \begin{align*}
    \[      f_i(x, x') = g_i^{\bbeta}((x, x'), (a_1, a_1'), \dots, (a_k, a_k') )
      %% &= (g_i^{\bA}(x, a_1, a_2, \dots, a_k), g_i^{\bA}(x, a_1', a_2', \dots, a_k')),%
      = (g_i^{\bA}(x, \ba), g_i^{\bA}(x, \ba')),%
      %% \end{align*}%
      \]%
    \renewcommand\gA{\ensuremath{g}}%
    for some $k$, $\gA_i \in \sansClo_{k+1}(\bA)$, and constants tuples
    $\ba = (a_1, \dots, a_k)$ and $\ba' = (a_1', \dots, a_k')$ such that
    $a_i \betar a_i'$ ($1\leq i\leq k$). 
    By~(\ref{eq:0}), either
    \[
    (b, b') = \bigl(\gA_0(x_0, \ba), \gA_0(x_0, \ba')\bigr)
    \quad \text{ and } \quad 
    (z_1,z_1')= \bigl(\gA_0(y_0, \ba), \gA_0(y_0, \ba')\bigr),
    \]
    or vice-versa.  Since $x_0 \alphar y_0$ and 
    $a_i \betar a_i'$ ($1\leq i\leq k$), the $\alpha,\beta$-term condition
    entails
    \[
    \gA_0(x_0, \ba) \commr{\alpha}{\beta} \gA_0(x_0, \ba')
    \quad \Longleftrightarrow \quad 
    \gA_0(y_0, \ba) \commr{\alpha}{\beta} \gA_0(y_0, \ba').
    \]
    This and~(\ref{eq:0}) yield
    $(b,b')\in [\alpha, \beta]$ iff
    $(z_1,z_1')\in [\alpha, \beta]$.
    Similarly~(\ref{eq:1}) and $x_1 \alphar y_1$ imply
    $(z_1,z_1')\in [\alpha, \beta]$ iff
    $(z_2,z_2')\in [\alpha, \beta]$.  Inductively, we arrive at 
    $(b,b')\in [\alpha, \beta]$ iff $(c,c')\in [\alpha, \beta]$, as desired.

    We have thus proved $[\alpha, \beta]$ is a fixed point of $\Phiba$.
    %% Recall that the lattice order on $\Con \bA$ is complete, so t
    In other words, 
    $[\alpha, \beta]$ is a ``$\Phiba$-closed'' subset of $\beta$.
    (A set $B\subseteq \beta$ is called \defn{$\Phiba$-closed} provided
    $\Phiba(B) \subseteq B$.)
    Recall, if $f$ is a monotone increasing function defined on a
    complete poset $\<P, \leq\>$, then the least fixed point of $f$
    is $\Meet \{ p\in P \mid f p \leq p\}$. %(See, for example,~\cite{MR3012378}.)
    Thus,
    Lemma~\ref{lem:fixed-point-comm}~(\ref{item:002}) asserts that
    \[
            [\alpha, \beta] =\Meet \{ B \subseteq \beta \mid \Phiba(B) \subseteq B\}.
    \]

    We already proved $[\alpha, \beta]$ is
    $\Phiba$-closed, so it remains to check for every $\Phiba$-closed subset
    $B\subseteq \beta$ that $[\alpha, \beta] \subseteq B$.
    Fix a $\Phiba$-closed subset $B\subseteq \beta$. % (i.e., $\Phiba(B)\subseteq B$).
    It suffices to prove $\CC{\alpha}{\beta}{\Phiba(B)}$, since this implies 
    $[\alpha, \beta] \subseteq \Phiba(B) \subseteq B$.
    Thus, our goal is to establish the $\alpha, \beta$-term condition.

    Let $p \in \Pol_{k+1}(\bA)$ and $a \alphar a'$ and $c_i \betar c_i'$ ($1\leq i\leq k$);
    suppose $p(a, \bc) \mathrel{\Phiba(B)} p(a, \bc')$.
    We prove that these hypotheses entail the following relation:
    \begin{equation}
      \label{eq:1001}
      p(a', \bc) \mathrel{\Phiba(B)} p(a', \bc').
    \end{equation}
    By definition of $\Phiba$, (\ref{eq:1001}) 
    is equivalent to the existence of
    some pair $(b,b') \in B$ such that
    $(b,b') \mathrel{\Delta_{\beta, \alpha}} (p(a', \bc), p(a', \bc'))$.
    %% We wish to %% establish the same for $(p(a', \bc), p(a', \bc'))$. That
    %% %% is, we must
    %% find such a pair for $(p(a', \bc), p(a', \bc'))$---that is, 
    %% a pair in $B$ that is $\mathrel{\Delta_{\beta, \alpha}}$-related to
    %% $(p(a', \bc), p(a', \bc'))$.
    Notice that the pair $(p(a, \bc), p(a, \bc'))$
    belongs to $B$ since
    $(p(a, \bc), p(a, \bc')) \in \Phiba(B) \subseteq B$.  Also,
    $c_i \betar c_i'$ ($0\leq i<k$) implies
    \begin{align*}
    ((a,a), (c_1, c_1'), (c_1, c_1'), \dots, (c_{k}, c_{k}'))&\in \beta^{k+1} \quad \text{ and }\\
    ((a',a'), (c_1, c_1'), (c_1, c_1'), \dots, (c_{k}, c_{k}')) &\in \beta^{k+1}.
    \end{align*}
    Therefore,
    \begin{align}
      \label{item:444}
    p^{\beta}((a,a), (c_1, c_1'), (c_1, c_1'), \dots, (c_{k}, c_{k}'))
    &= (p^{\bA}(a, \bc), p^{\bA}(a, \bc')) \in \beta  \quad \text{ and }\\
    \label{item:5}
    p^{\beta}((a',a'), (c_1, c_1'), (c_1, c_1'), \dots, (c_{k}, c_{k}'))
    &= (p^{\bA}(a', \bc), p^{\bA}(a', \bc')) \in \beta.
    \end{align}
    Finally, $a\alphar a'$ implies $p(a, \bc) \alphar p(a', \bc)$, and this---together
    with~(\ref{item:444}) and~(\ref{item:5})---proves the pair
    $\bigl((p(a, \bc), p(a, \bc')), (p(a', \bc), p(a', \bc'))\bigr)$
    belongs to  $\mathrel{\Delta_{\beta, \alpha}}$.
    Since  $(p(a, \bc), p(a, \bc')) \in B$, this proves
    $(p(a', \bc), p(a', \bc')) \in \Phiba(B)$, completing the proof.
  \end{proof}
\bigskip
\end{comment}

\subsection{Absorption Theorem (Barto and Kozik)}
% K and Theorem 3.2 of BKS}
% First we recall the Absorption Theorem  of Barto and Kozik.
\begin{theorem}[Absorption Theorem \protect{\cite[Thm~2.3]{MR2893395}}]
\label{thm:absorption}
%% If $\var{V}$ is an idempotent locally finite variety, then the following are equivalent:
%% \begin{itemize}
%% \item $\var{V}$ is a Taylor variety;
%% \item if $\bA_0, \bA_1 \in \var{V}$ are finite absorption-free algebras, 
%%   and if $\bR \sdp \bA_0 \times \bA_1$ is linked, then $\bR = \bA_0 \times \bA_1$.
%% \end{itemize}
Let $\bA$ and $\bB$ be finite
idempotent algebras with Taylor terms; let $\bR$ be a subdirect product of
$\bA \times \bB$, and let $\etaR_A$ ($\etaR_B$, resp.) be the kernel of the
projection $\bR \onto \bA$ ($\bR \onto \bB$, resp.).
If $\etaR_A \join \etaR_B = 1_R$, then either $\bR = \bA \times \bB$, or
$\bA$ has a proper absorbing subuniverse, or $\bB$ has a proper absorbing subuniverse.
\end{theorem}


\begin{theorem}[\protect{\cite[Theorem 3.2]{MR3374664}}]
  Let $\sV$ be a locally finite variety generated by a set $\sA$ of
  idempotent ``hereditarily absorption free'' algebras.
  If $\sV$ has a Taylor term, then it has a Mal'tsev term.
\end{theorem}
\begin{proof}
  Let $\bF = \bF_{\sV}(x,y)$ be the 2-generated free algebra
  %% , with generators $x, y$, 
  in the variety $\sV$. Since it is
  finite, $\bF$ lies in the pseudovariety generated by $\sA$, and thus it is
  absorption-free (see \cite[Proposition 2.1.(1)]{MR3374664}).
  Let $\bR$ be the subalgebra of $\bF^2$ generated by
  $(x, y), (x, x), (y, x)$. It is subdirect in $\bF^2$.
  Since $\bF$ is idempotent, $\etaR_A \join \etaR_B = 1_R$.
  % (as observed in Lemma~\ref{lem:preliminary-facts}~(\ref{item:5})).
  Consequently, by Theorem~\ref{thm:absorption},
  $\bR = \bF^2$, and there is a term $m$ witnessing
  that $(y, y) \in R$, i.e., a term $m$ satisfying
  $m((x, y), (x, x), (y, x)) = (y, y)$. This
  term is a Mal'tsev term for $\sV$.
\end{proof}

\begin{remark}
  \label{rem:absorpt-theor-bk}
  Let $\pi_0$ and $\pi_1$ be the first and second projections of $\bR$ onto $\bF$.
  Since $\bF$ is idempotent, $\{x\}$ is a subalgebra of $\bF$, hence the inverse
  image of $\{x\}$ under $\pi_0$ is a subuniverse of $\bR$, call it $S_0$.
  Since $(x,y)$ and $(x,x)$ lie in $S_0$, and $\{x,y\}$
  generates $\bF$, we see that $\{x\}\times F$ is contained in $S_0$.
  In particular, for every $a_1$, the pair $(x,a_1)$ must lie in $R$.
  Similarly, there is a subalgebra $S_1$ containing
  $F\times \{x\}$. %% Note that the kernels of $\pi_A$ and $\pi_B$ are $\eta_A$ and $\eta_B$. 
  Finally, for any $(a_0,a_1)$ and $(a_0',a_1')$ in $R$ we have
  %% \[
  %% (a_1,a_2) \mathrel{\eta_B} (x,a_2) \mathrel{\eta_A} (x,x) \mathrel{\eta_B} (b_1,x) \mathrel{\eta_A} (b_1,b_2).
  %% \]
  \[
  (a_0,a_1) \mathrel{\eta_1} (x,a_1) \mathrel{\eta_0} (x,a_1') \mathrel{\eta_1} (a_0',a_1').
  \]
  %% Cliff: You and I talked about whether Theorem 3.2 required idempotence.
  %%        Apparently it does. Is the idempotent reduct of an abelian algebra still abelian?
\end{remark}

\bigskip


\bibliographystyle{alphaurl}
\bibliography{inputs/refs2.bib}

\end{document}



%% NEW STUFF




\appendix

\section{Other ideas that, so far, haven't worked}




%% \section{Definitions and Notations}
%% \label{sec:defin-notat}

%% Cliff's book~\cite{MR2839398}.
%% My GitHub repo~\cite{overalgebras-github}.
%% \appendix
%% \section{Appendix Title}
%% This is the text of the appendix, if you need one.

%\bibliographystyle{amsplain} %% or amsalpha
%% \bibliographystyle{plain-url}



\appendix


\bibliographystyle{alphaurl}
\bibliography{inputs/refs2.bib}

\end{document}
