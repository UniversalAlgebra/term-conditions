%% FILE: com-fix-poi.tex
%% AUTHORS: William DeMeo
%% DATE: 1 Mar 2017
%% COPYRIGHT: (C) 2017 William DeMeo
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                         BIBLIOGRAPHY FILE                                 %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The `filecontents` command will crete a file in the inputs directory called 
%% refs.bib containing the references in the document, in case this file does 
%% not exist already.
%% If you want to add a BibTeX entry, please don't add it directly to the
%% refs.bib file.  Instead, add it in this file between the
%% \begin{filecontents*}{refs.bib} and \end{filecontents*} lines
%% then delete the existing refs.bib file so it will be automatically generated 
%% again with your new entry the next time you run pdfaltex.
\begin{filecontents*}{com-refs.bib}
@article{Bergman-DeMeo-2016,
  author    = {Clifford Bergman and William DeMeo},
  title     = {Universal Algebraic Methods for Constraint Satisfaction Problems},
  journal   = {CoRR},
  volume    = {abs/1611.02867},
  year      = {2016},
  url       = {http://arxiv.org/abs/1611.02867},
  timestamp = {Thu, 01 Dec 2016 19:32:08 +0100},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/BergmanD16},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}
@article {MR1358491,
    AUTHOR = {Kearnes, Keith A.},
     TITLE = {Varieties with a difference term},
   JOURNAL = {J. Algebra},
  FJOURNAL = {Journal of Algebra},
    VOLUME = {177},
      YEAR = {1995},
    NUMBER = {3},
     PAGES = {926--960},
      ISSN = {0021-8693},
     CODEN = {JALGA4},
   MRCLASS = {08B10 (08B05)},
  MRNUMBER = {1358491},
MRREVIEWER = {H. Peter Gumm},
       DOI = {10.1006/jabr.1995.1334},
       URL = {http://dx.doi.org/10.1006/jabr.1995.1334},
}
\end{filecontents*}
\documentclass[12pt]{amsart}
% The following \documentclass options may be useful:
% preprint      Remove this option only once the paper is in final form.
% 10pt          To set in 10-point type instead of 9-point.
% 11pt          To set in 11-point type instead of 9-point.
% numbers       To obtain numeric citation style instead of author/year.

%% \usepackage{setspace}\onehalfspacing

\usepackage{amsmath}
\usepackage{amscd,amssymb,amsthm} %, amsmath are included by default
\usepackage{latexsym,stmaryrd,mathrsfs,enumerate,scalefnt,ifthen}
\usepackage{mathtools}
\usepackage[mathcal]{euscript}
\usepackage[colorlinks=true,urlcolor=black,linkcolor=black,citecolor=black]{hyperref}
\usepackage{url}
\usepackage{scalefnt}
\usepackage{tikz}
\usepackage{color}
\usepackage[margin=1in]{geometry}
\usepackage{scrextend}

%%////////////////////////////////////////////////////////////////////////////////
%% Theorem styles
\numberwithin{equation}{section}
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{prop}[theorem]{Proposition}
\theoremstyle{definition}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{notation}[theorem]{Notation}
\newtheorem{Fact}[theorem]{Fact}
\newtheorem*{fact}{Fact}
\newtheorem{example}[theorem]{Example}
\newtheorem{examples}[theorem]{Examples}
\newtheorem{exercise}{Exercise}
\newtheorem*{lem}{Lemma}
\newtheorem*{cor}{Corollary}
\newtheorem*{remark}{Remark}
\newtheorem*{remarks}{Remarks}
\newtheorem*{obs}{Observation}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Acronyms
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% \usepackage[acronym, shortcuts]{glossaries}
%\usepackage[smaller]{acro}
\usepackage[smaller]{acronym}
\usepackage{xspace}

%% \acs{CSP} -- short version of the acronym\\
%% \acl{CSP} -- expanded acronym without mentioning the acronym.\\
%% \acp{CSP} -- plurals.\\
%% \acfp{CSP} -- long forms into plurals.\\
%% \acsp{CSP} -- short form into a plural.\\
%% \aclp{CSP} -- long form into a plural.\\
%% \acfi{CSP} -- Full Name acronym in italics and abbreviated form in upshape.\\
%% \acsu{CSP} -- short form of the acronym and marks it as used.\\
%% \aclu{CSP} -- Prints the long form of the acronym and marks it as used.\\

\acrodef{lics}[LICS]{Logic in Computer Science}
\acrodef{sat}[SAT]{satisfiability}
\acrodef{nae}[NAE]{not-all-equal}
\acrodef{ctb}[CTB]{cube term blocker}
\acrodef{tct}[TCT]{tame congruence theory}
\acrodef{wnu}[WNU]{weak near-unanimity}
\acrodef{CSP}[CSP]{constraint satisfaction problem}
\acrodef{MAS}[MAS]{minimal absorbing subuniverse}
\acrodef{MA}[MA]{minimal absorbing}
\acrodef{cib}[CIB]{commutative idempotent binar}
\acrodef{sd}[SD]{semidistributive}
\acrodef{NP}[NP]{nondeterministic polynomial time}
\acrodef{P}[P]{polynomial time}
\acrodef{PeqNP}[P $ = $ NP]{P is NP}
\acrodef{PneqNP}[P $ \neq $ NP]{P is not NP}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{inputs/proof-dashed}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Put new macros in the macros.sty file
\usepackage{inputs/macros}

\begin{document}

%% \title[Computing the Commutator Efficiently]{Computing the commutator efficiently}
\title{Computing the commutator efficiently}
\date{\today}
\author[W.~DeMeo]{William DeMeo}
\address{University of Hawaii}
\email{williamdemeo@gmail.com}

%% \thanks{The authors would like to extend special thanks to...}

\maketitle

\renewcommand{\etaR}{\ensuremath{\eta}}

%% \begin{abstract}
%% This note provides some tools that should enable us to prove
%% the following: if $\bA$ is a finite idempotent algebra with a
%% difference term operation, then the 2-generated free algebra in $\bbV(\bA)$ has
%% a difference term operation.  
%% \end{abstract}

%% \renewcommand{\bbeta}{\ensuremath{\ubar{\boldsymbol{\beta}}}}

\begin{abstract}
  In this note we give a polynomial-time algorithm for computing the
  (term condition) commutator. The algorithm is based on 
  a description of the commutator that is
  similar to the one in Kearnes~\cite[p.~930]{MR1358491}
  %% (here $\beta$ is a congruence of $\bA$ and $\bA \times_\beta \bA$ denotes the subalgebra of
  %% $\bA^2$ with universe $\beta$):
  %% \begin{quote}
  %% %% ``When $\alpha$ and $\beta$ are reflexive, compatible relations
  %% %% First, when $\beta$ is a reflexive, compatible binary relation on $A$
  %% %% we...
  %% ``Let $\Delta_{\beta,\alpha}$ be the congruence on $\bA \times_\beta \bA$ generated by
  %% \[\{\<(x, x), (y, y)\> \mid (x, y) \in \alpha\}.\]
  %% Call a subset $G \subseteq A^2$ {\bf $\Delta$-closed} if
  %% \[
  %% \Delta_{\beta,\alpha}\circ G \circ \Delta_{\beta,\alpha} \subseteq G.
  %% \]
  %% When $\alpha$ and $\beta$ are reflexive, compatible relations, then $[\alpha, \beta]$
  %% is the smallest subset $\gamma \subseteq A^2$ such that (i) $\gamma$
  %% is a congruence of $\bA$ and (ii) $\gamma$ is $\Delta$-closed.''
  %% \end{quote}
\end{abstract}


\section{Introduction}
%% The genesis of these notes was my attempt to interpret the expression 
%% $\Delta_{\beta,\alpha}\circ G \circ \Delta_{\beta,\alpha}$.
%% Noting that 
%% $\Delta_{\beta,\alpha} \subseteq (A\times A)^2$ while
%% $G\subseteq A^2$, a standard means of composing 
%% relations such as these, with different arities, was not immediately apparent.
%% In this note I give one possible interpretation
%% of Keith's ``useful alternate description of $[\alpha, \beta]$.''
%% The commutator is a fixed point
%% (i.e., closed set) of a certain closure operator
%% involving the relation $\Delta_{\beta, \alpha}$ defined above.

\subsection{Notation and Definitions}
\label{sec:defs}
Let $A$ and $B$ be sets and let $\alpha \subseteq A\times A$ and $\beta \subseteq B\times B$
be binary relations on $A$ and $B$, respectively.
We define
%% let $\alpha \otimes \beta$ denote the
the \emph{pairwise product} of $\alpha$ and $\beta$ as
\begin{equation}
\label{eq:pair-product}
\alpha \otimes \beta = \{\bigl((a, b), (a', b')\bigr) 
\in (A\times B)^2 \mid a\mathrel{\alpha} a'\, \text{ and } \,  b\mathrel{\beta} b'\},
\end{equation}
reserving $\alpha \times \beta$ for the usual Cartesian product,
%% of the sets $\alpha$ and $\beta$, that is,
\begin{equation}
\label{eq:set-product}
\alpha \times \beta = \{\bigl((a, a'), (b, b')\bigr) 
\in A^2\times B^2 \mid a\mathrel{\alpha} a' \, \text{ and } \, b\mathrel{\beta} b'\}.
\end{equation}
Notice that $\alpha \otimes \beta$ defines an equivalence relation on
$A\times B$, whereas $\alpha\times \beta$ is generally
not even a binary relation on a  set.
The equivalence class of $\alpha \otimes \beta$ containing the pair
$(a, b)$ is % \in A\times B$ is
\[(a,b)/(\alpha \otimes \beta) = a/\alpha \times b/\beta= 
    \{(a', b') \in A\times B \mid a\mathrel{\alpha} a' \, \text{ and } \,  b\mathrel{\beta} b'\},
    \]
which is simply the Cartesian product of the sets $a/\alpha$ and $b/\beta$.
The collection of all such equivalence classes is also a Cartesian product, namely,
\[
(A\times B)/(\alpha \otimes \beta) =
A/\alpha \times B/\beta  = \{(a, b)/(\alpha \otimes \beta) \mid a\in A \, \text{ and } \, b \in B\}.\]
%% \begin{remarks}\
%%   \begin{enumerate}
%%   \item The equivalence relations $\alpha$ and $\beta$ are subsets
%%     of $A^2$ and $B^2$, respectively, so it might seem more natural to interpret 
%%     $\alpha \times \beta$ as a subset of $A^2 \times B^2$. Nonetheless, in this 
%%     context it is usually more convenient to arrange the coordinates 
%%     so that $\alpha \times \beta \subseteq (A \times B)^2$, as in
%%     item~(\ref{item:9}).
%%   \end{enumerate}
%% \end{remarks}


For an algebra $\bA$ with congruence relations $\alpha$, $\beta\in \Con\bA$,
let $\bbeta$ denote the subalgebra of $\bA\times \bA$ with universe 
$\beta$, and let $0_A$ denote the subset $\{(a,a) \mid a\in A\} \subseteq \beta$.
Denote by $D_\alpha$ the following subset of $\beta \times \beta$:
\[
D_\alpha =(\alpha \otimes \alpha) \cap (0_A \times 0_A)
= \{((a,a), (b,b)) \in (0_A \times 0_A) \mid a\alphar b\}.
\]
Finally, let $\Delta_{\beta, \alpha}$ be the congruence of $\bbeta$ generated by
$D_\alpha$; that is, $\Delta_{\beta, \alpha} := \Cg^{\bbeta}(D_\alpha)$.
%% \end{align}
%% \begin{align}
%%   D_\alpha&:=(\alpha \otimes \alpha) \cap (0_A \times 0_A)
%%   = \{((a,a), (b,b)) \in (0_A \times 0_A) \mid a\alphar b\}, \text{ and }\\
%% \Delta_{\beta, \alpha} &:= \Cg^{\bbeta}(D_\alpha),
%% \end{align}
%% That is, \Delta_{\beta, \alpha} is the congruence on $\bbeta$ generated by the set $D^2_\alpha$.
%% As usual, the congruence class of $\Delta_{\beta, \alpha}$ that contains
%% $(b,b')$ is denoted and defined by 
%% \[
%% (b,b')/\Delta_{\beta,\alpha} = \{(a,a') \in \beta \mid (a,a') \mathrel{\Delta_{\beta,\alpha}} (b,b')\}.
%% \]


We say that the condition $\CC{\alpha}{\beta}{\gamma}$
holds iff for all $a \alphar b$, for all $u_i \betar v_i$ ($1\leq i\leq n$), and for all 
$t\in \Pol_{n+1}(\bA)$ we have
$t(a,\bu) \mathrel{[\alpha, \beta]} t(a, \bv)$
iff $t(b,\bu) \mathrel{[\alpha, \beta]} t(b, \bv)$.
It is sometimes convenient to write such equivalences as a (two-way) derivation tree,
as follows:
\[
\infer=[\CC{\alpha}{\beta}{\gamma}]{\Gamma \vdash t(b,\bu) \mathrel{[\alpha, \beta]} t(b, \bv)}{\Gamma \vdash t(a,\bu) \mathrel{[\alpha, \beta]} t(a, \bv)}\]
where $\Gamma$ is a context containing
$a \alphar b$, $u_i \betar v_i$ ($1\leq i\leq n$), and 
$t\in \Pol_{n+1}(\bA)$.

Consider the relation
%% \begin{equation}
%%   \label{eq:3}
%%   \Delta_{\alpha, \beta} \circ \gamma^2 \circ \Delta_{\alpha, \beta} =
%%   \{\bigl((x,x),(y,y)\bigr) \mid \bigl(\exists (a,b) \in \gamma \bigr) \,
%%   (x,x) \mathrel{\Delta_{\alpha, \beta}} (a,a)\, \text{ and } \,
%%   (b,b) \mathrel{\Delta_{\alpha, \beta}} (y,y)\}.
%% \end{equation}
\begin{equation}
  \label{eq:3}
  \Delta_{\alpha, \beta} \circ \gamma^2 \circ \Delta_{\alpha, \beta} =
  \left\{
  \begin{bmatrix} x & x'\\y & y' \end{bmatrix}
  %% \left(
  %% \begin{pmatrix} x\\y \end{pmatrix},
  %% \begin{pmatrix} x'\\y' \end{pmatrix}
  %% \right)
  \,\middle|\,
  \bigl(\exists a, b, a', b'\bigr) \,
  \begin{bmatrix} x\\y \end{bmatrix}
  \mathrel{\Delta_{\alpha, \beta}}
  \begin{bmatrix} a\\b \end{bmatrix}
  \mathrel{\gamma\otimes \gamma}
  \begin{bmatrix} a'\\b' \end{bmatrix}
  \mathrel{\Delta_{\alpha, \beta}}
  \begin{bmatrix} x'\\y' \end{bmatrix}\right\}
\end{equation}
We call an equivalence relation $\theta\in \Eq(A)$ ``$\Delta_{\beta,\alpha}$-closed'' if
it is closed with respect to the relation~(\ref{eq:3});
that is, $\theta$ is $\Delta_{\beta,\alpha}$-closed if
$\bigl((x,x),(y,y)\bigr) \in \Delta_{\alpha, \beta} \circ \theta^2 \circ \Delta_{\alpha, \beta}$
implies $(x,y) \in \theta$.

Keith claims that the commutator is the least $\gamma\in \Con (\bA)$
that is 
%% $\Delta_{\alpha, \beta} \circ \gamma^2 \circ \Delta_{\alpha, \beta}$; that is, closed under the following relation:
The reasoning seems to be that the term condition $\CC{\alpha}{\beta}{\gamma}$ implies
the following derivation\footnote{In this notation, the stuff below the horizontal line
  is a consequence of the stuff above the horizontal line.}
%% \[
%%   \begin{bmatrix} t(b,\bu) \\ t(b,\bu)  \end{bmatrix}
%%   \mathrel{\Delta_{\alpha, \beta}}
%%   \begin{bmatrix} t(a,\bu) \\ t(a,\bu)  \end{bmatrix}
%%   \mathrel{\gamma^2}  %% \mathrel{[\alpha, \beta]^2} 
%%   \begin{bmatrix} t(a,\bv) \\ t(a,\bv)  \end{bmatrix}
%%   \mathrel{\Delta_{\alpha, \beta}}
%%   \begin{bmatrix} t(b,\bv) \\ t(b,\bv)  \end{bmatrix}}
%%   \begin{bmatrix} t(b,\bu) \\ t(b,\bu)  \end{bmatrix}
%%   \mathrel{\Delta_{\alpha, \beta}}
%%   \begin{bmatrix} t(a,\bu) \\ t(a,\bu)  \end{bmatrix}
%%   \mathrel{[\alpha, \beta]^2}    %% \mathrel{[\alpha, \beta]^2} 
%%   \begin{bmatrix} t(a,\bv) \\ t(a,\bv)  \end{bmatrix}
%%   \mathrel{\Delta_{\alpha, \beta}}
%%   \begin{bmatrix} t(b,\bv) \\ t(b,\bv)  \end{bmatrix}}
%% $\CC{\alpha}{\beta}{\gamma}$ holds iff is the following:Therefore, 
\[
\infer{\begin{bmatrix} t(b,\bu) \\ t(b,\bu)  \end{bmatrix}
  \mathrel{\gamma^2} %% \mathrel{[\alpha, \beta]^2} 
  \begin{bmatrix} t(b,\bv) \\ t(b,\bv)  \end{bmatrix}}
{\begin{bmatrix} t(b,\bu) \\ t(b,\bu)  \end{bmatrix}
  \mathrel{\Delta_{\alpha, \beta}}
  \begin{bmatrix} t(a,\bu) \\ t(a,\bu)  \end{bmatrix}
  \mathrel{\gamma^2}  %% \mathrel{[\alpha, \beta]^2} 
  \begin{bmatrix} t(a,\bv) \\ t(a,\bv)  \end{bmatrix}
  \mathrel{\Delta_{\alpha, \beta}}
  \begin{bmatrix} t(b,\bv) \\ t(b,\bv)  \end{bmatrix}}
\]

\renewcommand{\downbeta}{\ensuremath{\lb 0_A, \beta\rb}}
Now, let $\downbeta$ denote the set of equivalence relations on $A$ that are contained
in $\beta$; that is, 
 $\downbeta:= \{\theta \in \Eq(A) \mid 0_A \leq \theta \leq \beta\}$. 
Let $\Phi_{\beta, \alpha} \colon \downbeta\to \downbeta$ be the function defined
for each $0_A \leq \theta \leq \beta$ as follows:
\begin{equation}
  \label{eq:6}
  \Phi_{\beta, \alpha}(\theta)
  = \{ (x,y) \in A^2 \mid
  \bigl(\exists\, (a,b) \in \theta\big)\,
\bigl(  (x,x) \mathrel{\Delta_{\beta, \alpha}} (a,a) \text{ and }
  (b,b) \mathrel{\Delta_{\beta, \alpha}} (y,y)\bigr)\}.
\end{equation}
It seems to me the statement that an equivalence relation $\gamma$ is
``$\Delta_{\beta, \alpha}$-closed'' is equivalent to the statement
$\Phi_{\beta,\alpha}(\gamma)\subseteq \gamma$, and it's not clear to me
that the commutator satisfies
$\Phi_{\beta,\alpha}\bigl([\alpha, \beta]\bigr) \subseteq [\alpha, \beta]$.

\section{Fixed Point Lemma}
We will compose $\Phi_{\beta, \alpha}$ with itself; recall
the standard notational conventions for doing so:
$\Phi_{\beta, \alpha}^0(\theta) = \theta$, and for $n\geq 0$, 
$\Phi_{\beta, \alpha}^{n+1}(\theta) = \bigl(\Phi_{\beta, \alpha} \circ \Phi_{\beta, \alpha}^{n}\bigr)(\theta)
 = \Phi_{\beta, \alpha} \bigl(\Phi_{\beta, \alpha}^{n}(\theta)\bigr)$.
Thus,
\[
\Phi_{\beta, \alpha}^{n+1}(\theta) =
\{ (x,y) \in A^2 \mid   \bigl(\exists\, (a,b) \in \Phi_{\beta, \alpha}^{n}(\theta)\bigr)
  \bigl((x,x) \mathrel{\Delta_{\beta, \alpha}} (a,a) \text{ and }
  (b,b) \mathrel{\Delta_{\beta, \alpha}} (y,y)\bigr)\}.
\]


%% Let $\Psi_{\beta, \alpha} \colon \Eq(\beta) \to \Eq(\beta)$ be the function that
%% takes each $\theta \in \Eq(\beta)$ to the equivalence relation
%% \begin{align*}
%%   \Psi_{\beta, \alpha}(\theta) &= \Delta_{\beta, \alpha} \circ (\theta \otimes \theta) \circ \Delta_{\beta, \alpha} \\
%%   &= \{\bigl((x,y), (x',y')\bigr) \mid \bigl(\exists (r, r') \in \theta\bigr) \;
%%   \bigl((x,y) \mathrel{\Delta_{\beta, \alpha}} (r,r) \; \text{ and } \;  (r',r')
%%   \mathrel{\Delta_{\beta, \alpha}} (x'y')\bigr)\}\\
%%   &= \{\bigl((x,y), (x',y')\bigr) \mid \bigl(\exists (r, r')\bigr) \;
%%   (x,y) \mathrel{\Delta_{\beta, \alpha}} (r,r) \mathrel{(\theta \otimes \theta)} (r',r')
%%   \mathrel{\Delta_{\beta, \alpha}} (x'y')\}.
%% \end{align*}
\newcommand{\Phiba}{\ensuremath{\Phi_{\beta, \alpha}}}
%% \newcommand{\Phiba}{\ensuremath{\Phi}}
\newcommand{\Psiba}{\ensuremath{\Psi}}
\newcommand{\thetaba}{\ensuremath{\theta_{\beta, \alpha}}}



%% For an algebra $\bA$ with congruence relations $\alpha$, $\beta\in \Con\bA$,
%% let $\bbeta$ denote the subalgebra of $\bA\times \bA$ with universe 
%% $\beta$.
%% Let $0_A = \{(a,a) \mid a\in A\}$ and 
%% $D_\alpha := (\alpha \otimes \alpha) \cap (0_A \times 0_A) = \{((a,a), (b,b)) \in D^2 \mid a\alphar b\}$.
%% Finally, let
%% $\Delta_{\beta, \alpha} = \Cg^{\bbeta}\bigl(D^2_\alpha \bigr)$ be
%% the congruence on $\bbeta$ generated by the set $D^2_\alpha$.
%% The congruence class of $\Delta_{\beta, \alpha}$ that contains $(b,b')$ is
%% denoted and defined as follows:
%% \[
%% (b,b')/\Delta_{\beta,\alpha} = \{(a,a') \in \beta \mid (a,a') \mathrel{\Delta_{\beta,\alpha}} (b,b')\}.
%% \]
%% Let $\Phi_{\beta, \alpha} \colon \sP(\beta) \to \sP(\beta)$ be the function that
%% takes each $B \subseteq \beta$ to
%% \begin{equation}
%%   \label{eq:6}
%%   \Phi_{\beta, \alpha}(B) = \bigcup_{(b,b')\in B} (b,b')/\Delta_{\beta, \alpha}.
%% \end{equation}
%% %% \newcommand{\Phiba}{\ensuremath{\Phi_{\beta, \alpha}}}
%% %% \newcommand{\Phiba}{\ensuremath{\Phi}}





\begin{lemma}
  \label{lem:fixed-point-comm}
  Let $\bA$ be an algebra with $\alpha$, $\beta\in \Con(\bA)$.
  If
  $\Phiba$ is defined as in~(\ref{eq:6}), then
  %% $\Phi:=\Phi_{\beta, \alpha}$ is defined as in~(\ref{eq:6}), then 
  \begin{enumerate}[(i)]
  \item \label{item:1} $\Phiba$ is a closure operator on %% $\sP(\beta)$;
    $\downbeta$;
  \item \label{item:2} $[\alpha, \beta]$ is the least fixed point of $\Phiba$.
  \end{enumerate}
\end{lemma}
\begin{remark}
  Since $\Phiba$ is clearly a monotone increasing function on the (complete) sublattice
  $\downbeta \leq \Eq(A)$, it is guaranteed to have a least fixed point.  In fact,
  the least fixed point is precisely given by 
  %% $\thetaba := \bigcup_{k\geq 0} \Phiba^{k}(0_A)$.
  $\nu := \bigcup_{k\geq 0} \Phiba^{k}(0_A)$.
  %% That is $\Phiba\bigl(\thetaba\bigr) = \thetaba$,
  That is $\Phiba(\nu) = \nu$,
  and $\nu \subseteq \theta$ for every $\theta\in \Eq(\beta)$
  satisfying $\Phiba(\theta) = \theta$.
   %% $\thetaba \subseteq \theta$.
   
\end{remark}

\begin{proof}\
  %% \begin{enumerate}[(i)]
  %% \item 
\noindent (i) Fix $\theta \subseteq \beta$. We prove
    (i.1) $\theta \subseteq \Phiba(\theta)$;     
    (i.2) $\theta \subseteq C  \Rightarrow \Phiba(\theta) \subseteq \Phiba(C)$;    
    (i.3) $\Phiba(\Phiba(\theta))  = \Phiba(\theta)$. Indeed,
    if $(a,b) \in \theta$ then $(a,b) \in \Phiba(\theta)$ since 
    $(a,a)\mathrel{\Delta_{\beta, \alpha}} (a,a)$ and 
    $(b,b)\mathrel{\Delta_{\beta, \alpha}} (b,b)$;
    %% ~(\ref{eq:6}) does not discard any of the pairs that were already in $\theta$.
    %% Thus, $G \subseteq \Phiba(G)$ proving~(\ref{item:1}).
    (i.2) holds since $(x,y) \in \Phiba(\theta)$ iff there exists
    $(a,b) \in \theta \subseteq C$ such that
    $(x,x) \mathrel{\Delta_{\beta, \alpha}} (a,a)$
    and $(b,b) \mathrel{\Delta_{\beta, \alpha}} (y,y)$, and this along with
    $(a,b)\in C$ implies $(x,y) \in \Phiba(C)$;
    (i.3) obviously holds by
    %% , it clearly follows from
    %% (a) and (b) that $\Phiba(\theta)\subseteq \Phiba(\Phiba(\theta))$, so we prove the
    %% reverse inclusion.    
    %% Let $(d,d') \in \Phiba(\Phiba(\theta))$. Then
    %% $(c,c') \mathrel{\Delta_{\beta, \alpha}} (d,d')$ for some
    %% $(c,c') \in \Phiba(\theta)$, which implies
    %% $(b,b') \mathrel{\Delta_{\beta, \alpha}} (c,c')$ for some
    %% $(b,b') \in \theta$.  By 
    transitivity of $\Delta_{\beta, \alpha}$.
    %% we conclude that $(d,d') \in \Phiba(\theta)$, as desired.
    \bigskip

\noindent (ii)
Since $[\alpha, \beta] \leq \alpha \meet \beta\leq \beta$
we obviously have $[\alpha, \beta] \in \downbeta$; thus,
$[\alpha, \beta] \subseteq \Phiba([\alpha, \beta])$,
by~(\ref{item:1}).
    We prove the reverse inclusion.
    %% $\Phiba([\alpha, \beta]) \subseteq [\alpha, \beta]$.
    If $(x,y)\in \Phiba([\alpha, \beta])$, then~(\ref{eq:6})
    implies there exists $(a,b)\in [\alpha, \beta]$ such that
    \begin{equation}
      \label{eq:1000}
      (x,x) \mathrel{\Delta_{\beta, \alpha}} (a,a) \text{ and }
      (b,b) \mathrel{\Delta_{\beta, \alpha}} (y,y).
    \end{equation}
    From the definition of $\Delta_{\beta, \alpha}$ and 
    \malcev's theorem on congruence generation,~(\ref{eq:1000})
    holds if and only if
    $\exists \, z_i \betar z_i'$ $(0\leq i \leq n)$,
    $\exists \, x_i \alphar y_i$ $(0\leq i < n)$,
    $\exists\, f_i \in \Pol_1(\bA\times \bA)$ $(0\leq i < n)$
    such that
    $(x, x) = (z_0,z_0')$ and
    $(z_n,z_n') = (a,a)$, and
    \begin{align}
      \label{eq:0}
      \{(x, x),(z_1,z_1')\} &= \{f_0(x_0,x_0), f_0(y_0,y_0)\}\\
      \label{eq:1}
      \{(z_1,z_1'),(z_2,z_2')\} &= \{f_1(x_1,x_1), f_1(y_1,y_1)\}\\
      \nonumber
      & \vdots\\
      %% \label{eq:n-1}
      \nonumber
      \{(z_{n-1},z_{n-1}'),(a, a)\} &= \{f_{n-1}(x_{n-1},x_{n-1}), f_{n-1}(y_{n-1},y_{n-1})\}
    \end{align}
    For each $(0\leq i < n)$, $f_i \in \Pol_1(\bA\times \bA)$, which means
    \newcommand\gA{\ensuremath{g^{\bA}}}%
    %% \begin{align*}
    \[      f_i(x_i, x_i) = g_i^{\bbeta}((x_i, x_i), (a_1, a_1'), \dots, (a_k, a_k') )
      %% &= (g_i^{\bA}(x, a_1, a_2, \dots, a_k), g_i^{\bA}(x, a_1', a_2', \dots, a_k')),%
      = (g_i^{\bA}(x_i, \ba), g_i^{\bA}(x_i, \ba')),%
      %% \end{align*}%
      \]%
    \renewcommand\gA{\ensuremath{g}}%
    for some $k$, $\gA_i \in \sansClo_{k+1}(\bA)$, and constants tuples
    $\ba = (a_1, \dots, a_k)$ and $\ba' = (a_1', \dots, a_k')$ such that
    $a_i \betar a_i'$ ($1\leq i\leq k$). 
    By~(\ref{eq:0}), either
    \[
    (x, x) = \bigl(\gA_0(x_0, \ba), \gA_0(x_0, \ba')\bigr)
    \quad \text{ and } \quad 
    (z_1,z_1')= \bigl(\gA_0(y_0, \ba), \gA_0(y_0, \ba')\bigr),
    \]
    or vice-versa.  Since $x_0 \alphar y_0$ and 
    $a_i \betar a_i'$ ($1\leq i\leq k$), the $\alpha,\beta$-term condition
    entails
    \[
    \gA_0(x_0, \ba) \commr{\alpha}{\beta} \gA_0(x_0, \ba')
    \quad \Longleftrightarrow \quad 
    \gA_0(y_0, \ba) \commr{\alpha}{\beta} \gA_0(y_0, \ba').
    \]
    This and~(\ref{eq:0}) yield
    $(x,x)\in [\alpha, \beta]$ iff
    $(z_1,z_1')\in [\alpha, \beta]$.
    Similarly~(\ref{eq:1}) and $x_1 \alphar y_1$ imply
    $(z_1,z_1')\in [\alpha, \beta]$ iff
    $(z_2,z_2')\in [\alpha, \beta]$.  Inductively, we arrive at 
    $(x,x)\in [\alpha, \beta]$ iff $(a,a)\in [\alpha, \beta]$.

    Of course, the same argument shows that 
    $(b,b)\in [\alpha, \beta]$ iff $(y,y)\in [\alpha, \beta]$.

    We have thus proved $[\alpha, \beta]$ is a fixed point of $\Phiba$.
    %% Recall that the lattice order on $\Con \bA$ is complete, so t
    In other words, 
    $[\alpha, \beta]$ is a ``$\Phiba$-closed'' subset of $\beta$.
    (A set $\theta\subseteq \beta$ is called \defn{$\Phiba$-closed} provided
    $\Phiba(\theta) \subseteq \theta$.)
    Recall, if $f$ is a monotone increasing function defined on a
    complete poset $\<P, \leq\>$, then the least fixed point of $f$
    is $\Meet \{ p\in P \mid f p \leq p\}$. %(See, for example,~\cite{MR3012378}.)
    Thus,
    Lemma~\ref{lem:fixed-point-comm}~(\ref{item:2}) asserts that
    \begin{equation}
      \label{eq:2}
            [\alpha, \beta] =\Meet \{ \theta \subseteq \beta \mid \Phiba(\theta) \subseteq \theta\}.
    \end{equation}

    We already proved $[\alpha, \beta]$ is
    $\Phiba$-closed, so it remains to check for every $\Phiba$-closed subset
    $\theta\subseteq \beta$ that $[\alpha, \beta] \subseteq \theta$.
    Fix a $\Phiba$-closed subset $\theta\subseteq \beta$. % (i.e., $\Phiba(\theta)\subseteq \theta$).
    It suffices to prove $\CC{\alpha}{\beta}{\Phiba(\theta)}$, since this implies 
    $[\alpha, \beta] \subseteq \Phiba(\theta) \subseteq \theta$.
    Thus, our goal is to establish the $\alpha, \beta$-term condition.

    Let $p \in \Pol_{k+1}(\bA)$ and $a \alphar a'$ and $c_i \betar c_i'$ ($1\leq i\leq k$);
    suppose $p(a, \bc) \mathrel{\Phiba(\theta)} p(a, \bc')$.
    We prove that these hypotheses entail the following relation:
    \begin{equation}
      \label{eq:1001}
      p(a', \bc) \mathrel{\Phiba(\theta)} p(a', \bc').
    \end{equation}
    By definition of $\Phiba$, (\ref{eq:1001}) 
    is equivalent to the existence of
    some pair $(b,b') \in \theta$ such that
    $(b,b') \mathrel{\Delta_{\beta, \alpha}} (p(a', \bc), p(a', \bc'))$.
    %% We wish to %% establish the same for $(p(a', \bc), p(a', \bc'))$. That
    %% %% is, we must
    %% find such a pair for $(p(a', \bc), p(a', \bc'))$---that is, 
    %% a pair in $\theta$ that is $\mathrel{\Delta_{\beta, \alpha}}$-related to
    %% $(p(a', \bc), p(a', \bc'))$.
    Notice that the pair $(p(a, \bc), p(a, \bc'))$
    belongs to $\theta$ since
    $(p(a, \bc), p(a, \bc')) \in \Phiba(\theta) \subseteq \theta$.  Also,
    $c_i \betar c_i'$ ($0\leq i<k$) implies
    \begin{align*}
    ((a,a), (c_1, c_1'), (c_1, c_1'), \dots, (c_{k}, c_{k}'))&\in \beta^{k+1} \quad \text{ and }\\
    ((a',a'), (c_1, c_1'), (c_1, c_1'), \dots, (c_{k}, c_{k}')) &\in \beta^{k+1}.
    \end{align*}
    Therefore,
    \begin{align}
      \label{item:4}
    p^{\beta}((a,a), (c_1, c_1'), (c_1, c_1'), \dots, (c_{k}, c_{k}'))
    &= (p^{\bA}(a, \bc), p^{\bA}(a, \bc')) \in \beta  \quad \text{ and }\\
    \label{item:5}
    p^{\beta}((a',a'), (c_1, c_1'), (c_1, c_1'), \dots, (c_{k}, c_{k}'))
    &= (p^{\bA}(a', \bc), p^{\bA}(a', \bc')) \in \beta.
    \end{align}
    Finally, $a\alphar a'$ implies $p(a, \bc) \alphar p(a', \bc)$, and this---together
    with~(\ref{item:4}) and~(\ref{item:5})---proves the pair
    $\bigl((p(a, \bc), p(a, \bc')), (p(a', \bc), p(a', \bc'))\bigr)$
    belongs to  $\mathrel{\Delta_{\beta, \alpha}}$.
    Since  $(p(a, \bc), p(a, \bc')) \in \theta$, this proves
    $(p(a', \bc), p(a', \bc')) \in \Phiba(\theta)$, completing the proof.
  \end{proof}

\bigskip

\section{Algorithm}
Given $\alpha$, $\beta \in \Con(\bA)$, we wish to compute $[\alpha, \beta]$.
We want an algorithm and constants $c$ and $k$ such that, for each
$\alpha$ and $\beta$, the algorithm computes $[\alpha, \beta]$
in a number of steps that is at most a constant time $n^k$
where $n$ is the number of bits required to encode
$\bA$, $\alpha$, and $\beta$.

\section{Application}
We now consider the important special case of a finite 2-generated
free algebra $\bF := \bF_{\sV}(x,y)$ over an idempotent variety $\sV$. 
When the context makes the meaning clear, we may use $1$ (instead of
$1_F$) to denote the set $F \times F$. 
%% It's easy to see that %As noted above in Lemma~\ref{lem:preliminary-facts}, 
%% $\Cg^{\bF}(x,y) = 1$, 
We will be particularly interested in the special case $\alpha = 1 = \beta$;
in that case, $D_\alpha = D_1 = 0_F \times 0_F$ and
\begin{equation}
\label{eq:11}  
\Delta_{1, 1} = \Cg^{F\times F}(0_F \times 0_F)
 = \Cg^{F\times F}\{\bigl((x,x), (y,y)\bigr) \mid x, y \in F\}.
\end{equation}

Recall that $\bF$ is abelian if and only if
 $\exists\, \Theta \in \Con (\bF^2)$ such that $0_F$ %% := \{(z,z)\mid z \in F\}$ 
 is a congruence class of $\Theta$. 
 Thus $\bF$ is nonabelian iff there exist
 $u, v\in F$ such that
 $u \neq v$ and $(u,v)\mathrel{\Delta_{1,1}}(x,x)$,
 for some (hence, every) $x\in F$. 
 (Otherwise, $0_F$ would be a congruence class of $\Delta_{1,1}$.)
%% For the purpose of deciding whether there exists a difference
%% term we can assume the algebras in question is nonabelian. 
%%  (We will see below why the nonabelian assumption comes without loss of generality.)
%%  Recall from Lemma~\ref{lem:diagonal-cong-class}
%%  that an algebra is abelian if and only if there is some 
%%  $\theta \in \Con (\bA^2)$ that has the diagonal $0_A:= \{(a,a)\mid a \in A\}$ 
%%  as a congruence class.
%%  Thus, if $\bF$ is nonabelian, then there must be 
%%  $u, v\in F$ such that
%%  $u \neq v$ and $ (u,v)\mathrel{\Delta_{1,1}}(x,x)$ (for all $x\in F$).


\bibliographystyle{alphaurl}
\bibliography{com-refs.bib}

\end{document}
