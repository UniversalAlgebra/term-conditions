\documentclass[notes=hide,12pt,xcolor=dvipsnames%,mathserif%,handout
   ]{beamer}
% \PassOptionsToClass{beamer}{handout}
% \usepackage{pgfpages} 
% \pgfpagesuselayout{4 on 1}[letterpaper,landscape,border shrink=3mm]
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{helvet}
%% \usepackage{../nsjom/macros}
\usepackage{../notes/inputs/macros}
\usepackage{comment}
\usepackage{xspace}
\usepackage{pifont}
\usepackage[all,cmtip,arrow]{xy}  %for xy-pic fonts
\usepackage{../notes/inputs/proof-dashed}
\usepackage{animate}
\usepackage[mathscr]{euscript}

%%macs

%For this presentation, I don't want citations
\renewcommand{\cite}[1]{\relax}
\renewcommand{\defn}[1]{\alert{#1}}
\newcommand{\defin}[1]{\alert{#1}}
% \newcommand{\V}{\ensuremath{\mathcal V}\xspace}
% \newcommand{\mbold}[1]{\ensuremath{\mathbf{#1}}\xspace}
% \makecs{\mbold}{ABDP}
\newcommand{\exmpl}[1]{{\color{green!50!black} #1}}
\newcommand{\dsize}{\displaystyle}
\DeclareMathOperator{\End}{End}
\DeclareMathOperator{\Var}{Var}
\newcommand{\bigpause}{\pause\bigskip}
\newcommand{\medpause}{\pause\medskip}

% \newcommand{\reduc}{\leq_{\text{\textnormal{p}}}}
% \newcommand{\equivp}{\equiv_{\text{\textnormal{p}}}}
% \newcommand{\NP}{\ensuremath{\mathbb{NP}}\xspace}
% \renewcommand{\P}{\ensuremath{\mathbb{P}}\xspace}
\newcommand{\Blue}{\textcolor{blue!50!black}}
\newcommand{\Red}{\textcolor{violet!50!red}}
\newcommand{\Green}{\textcolor{green!55!black}}
\let\origemph=\emph 
\let\origtextbf=\textbf 
%%endmacs
%%
\parskip=10pt
%% Beamer Setup
% \mode<handout>{\beamertemplatesolidbackgroundcolor{black!5}}
\mode<presentation>{
  % \usetheme{Singapore}
   % \usetheme{Frankfurt}
   % \usetheme{Pittsburgh}
   \usetheme{Boadilla}
   % \usetheme{lankton-keynote}
   \usecolortheme{beaver}
  % \useinnertheme[shadow]{rounded}
  \setbeamertemplate{navigation symbols}[only frame symbol]{}
}
% \mode<beamer>
% {%
%   \let\emph=\alert}
%   \renewcommand{\textbf}[1]{{\usebeamercolor[fg]{example text}%
%      \origtextbf{#1}}}
% }
\mode<article>{\usepackage{fullpage}}
%%
%\title{\TeX\ and \LaTeX\ in the Mathematics Department}
%\author{Clifford Bergman}

\renewcommand{\phi}{\ensuremath{\varphi}}

\theoremstyle{definition}
%% \newtheorem{defn}[thm]{Definition}
\newtheorem{question}{Question}
 %% \newtheorem{ex}[thm]{Example}

\includeonlyframes{title,defs,diff,diff-remarks,motivation-lit,motivation-heuristics,%
  computational,premature,
  local-diff-term-defs,local-diff-term-res,local-diff-term-cor,champion,algorithm,extensions,f2lem,f2thm,goal,pau}


\begin{document}
\title[Existence of Difference Terms]{On the Complexity of Existence of \\Difference Terms}
\author[\url{williamdemeo@gmail.com}]
       {William DeMeo\\
{\small \url{williamdemeo@gmail.com}}}
%% \\[5pt]{\small joint with}\\
%% {\small   Cliff Bergman and Ralph Freese}}

\date[11 Mar 2017]{AMS Special Session\\[10pt]
11 Mar 2017}

\frame[label=title]{\titlepage}

\setbeamercolor{block body example}%
{parent=normal text,use=block title example,bg=block title example.bg!25!bg}

%====================================================================
\section{Introduction}
\newcommand\oftype{\ensuremath{\mathrel{:}}}
%--------------------------------------------------------------------
\subsection{Preliminaries}
\begin{frame}[shrink=10,label=defs]{Notation and Definitions}
  Let $\bA = \<A, \dots\>$ be an algebra.
  
  A reflexive, symmetric, compatible relation $T\subseteq A^2$ is a
  \defn{tolerance} of $\bA$.  

  For $(\bu, \bv) \in A^m\times A^m$, we write
  $\bu \mathrel{\bT} \bv$ iff $u_i \mathrel{T} v_i$ holds $\forall i$.

  \pause 
  Let
  
  $\Tol(\bA) = $ the set of tolerance relations of $\bA$
  
  $\Con(\bA) = $ the set of congruence relations of $\bA$

  $\Sg^{\bA}(X) = $ the subalgebra of $\bA$ generated by $X \subseteq A$

  $\Cg^{\bA}(X) = $ the congruence of $\bA$ generated by $X \subseteq A\times A$
\end{frame}

\begin{frame}[shrink=10,label=defs]{Notation and Definitions}%
  %% {$S, T$-matrix and centralizer condition}
  Let $S, T \in \Tol(\bA)$

  An \defin{$S,T$-matrix} is an array of the form

  \[
  \begin{bmatrix*}[r] t(\ba,\bu) & t(\ba,\bv)\\ t(\bb,\bu)&t(\bb,\bv)\end{bmatrix*},
  \]
  where $t$, $\ba$, $\bb$, $\bu$, $\bv$ satisfy
  \begin{enumerate}[(i)] %[label=(\roman*)]
  \item $t\in \sansClo_{\ell + m}(\bA)$,
  \item $(\ba, \bb)\in A^\ell\times A^\ell$ and $\ba \mathrel{\bS} \bb$,
  \item $(\bu, \bv)\in A^m\times A^m$ and $\bu \mathrel{\bT} \bv$.
  \end{enumerate}
\pause
  If $\delta \in \Con \bA$ and the entries of every $S,T$-matrix satisfy
  \begin{equation}
    \label{eq:22}
    t(\ba,\bu) \mathrel{\delta} t(\ba,\bv)\quad \iff \quad t(\bb,\bu) \mathrel{\delta} t(\bb,\bv),
  \end{equation}
  then we say ``\defn{$S$ centralizes $T$ modulo $\delta$}'' and we write
  $\CC{S}{T}{\delta}$.
\end{frame}


\begin{frame}[label=defs]{What is the commutator?}
  %% \framesubtitle{the commutator}

  The \defin{commutator of $S$ and $T$} is denoted $[S, T]$ and defined to be
  the least $\delta\in \Con\bA$ such that $\CC{S}{T}{\delta}$ holds.  

  \medpause
  
  Note that $\CC{S}{T}{0_A}$ is equivalent to $[S,T] = 0_A$,
  %% ; this is sometimes called the \defin{$S, T$-term condition}.
  %% When the $S, T$-term condition holds
  and we say\\[4pt] \defn{$S$ centralizes $T$}.

  \medpause
  
  A tolerance (or congruence) $T$ is \defin{abelian} iff $[T, T] = 0_A$.  

  An algebra $\bA$ is \defin{abelian} iff $1_A$ is abelian.
  %% (i.e., $[1_A,1_A] = 0_A$).
\end{frame}

%%%%%%%%%%% Alternative views of the commutator %%%%%%%%%%%%%%%%%%%
%% \input{./inputs/alt-com-slides.tex}


%% \begin{frame}[shrink=5,label=diff]{What is a difference term?}
\begin{frame}[shrink=2,label=diff]{What is a difference term?}
  Let $\bA$ be an algebra.

  $d^{\bA}(x,y,z)$ is a \alert{difference term operation} iff 
  $\forall\, (a,b) \in \theta \in \Con \bA$
  \begin{equation}
    \label{eq:3}  
    a \comr{\theta} d^{\bA}(a,b,b) 
    \quad \text{ and } \quad
    d^{\bA}(a,a,b) = b 
  \end{equation}
  \pause
  Let $\sV$ be a variety. %% \onslide<3>{{\color{gray}(idempotent?)}}

  $d(x,y,z)$ is a \alert{difference term} (dt) for $\sV$ iff
  $d^{\bA}(x,y,z)$ is a difference term operation for every $\bA \in \sV$.

  \pause
  By monotonicity of $[\cdot, \cdot]$ we can replace $\theta$ 
  with $\Cg^{\bA}(a,b)$ in the def.

  \pause 
  If $d^{\bA}(a,a,b) \comr{\theta} b$ instead, $d^{\bA}$ is called a \alert{weak diff term op}.

  \pause
  If $\bA$ is \alert{abelian},
  $[\theta, \theta] = 0_A$ so
  (\ref{eq:3}) holds iff $d^{\bA}$ is Mal'tsev.

  \pause
  If $[\theta, \theta] = \theta$,  then
  $a \comr{\theta} d^{\bA}(a,b,b)$ $\forall (a, b) \in \theta$, so
  $d^{\bA}(x,y,z) = z$ is a dt operation.
  % If for all $a, b \in A$ the relations in (\ref{eq:3}) hold 
  % with $\theta = \Cg^{\bA}(a,b)$, then we call
  % $d^{\bA}$ a \defn{difference term operation} for $\bA$.
\end{frame}



%--------------------------------------------------------------------
\subsection{Motivation}

\begin{frame}[label=motivation-lit]{Motivation}
  %% \framesubtitle{prior art}

  Difference terms are studied extensively in the literature.

\begin{itemize}


\item
  {\footnotesize (1988)
    Hobby and McKenzie, ``The structure of finite algebras,''~{\bf 76} of
    {\em Contemporary Mathematics}, {\em Amer. Math. Soc.} }
\item
  {\footnotesize (1995) 
    Kearnes, ``Varieties with a difference term,'' 
    {\em J. Algebra} {\bf 177}(3).}
\item
  {\footnotesize (1996)
    Lipparini, ``A characterization of varieties with a difference term.''
    {\em Canad. Math. Bull.} {\bf 39}(3).}
\item
  {\footnotesize (1998)
    Kearnes and Szendrei, ``The relationship between two commutators,''
    {\em Internat. J. Algebra Comput.} {\bf 8}(4). } 
%% \item
%%   {\footnotesize (2013)
%%     Kearnes and Kiss, ``The shape of congruence lattices,'' 
%%     {\em Mem. Amer. Math. Soc.} {\bf 222}(1046).}
\item
  {\footnotesize (2014)
    Valeriote and Willard, ``Idempotent {$n$}-permutable varieties,'' 
    {\em Bull. Lond. Math. Soc.} {\bf 46}(4).}
\item
  {\footnotesize (2016)
    Kearnes, Szendrei, and Willard, ``A finite basis theorem for
    difference-term varieties with a finite residual bound,'' 
    {\em Trans. Amer. Math. Soc.} {\bf 368}(3).}
\item
  {\footnotesize (2017)
  Kearnes, Szendrei and Willard, ``Simpler maltsev conditions for (weak)
  difference terms in locally finite varieties,'' to appear.}
\end{itemize}
\end{frame}


\begin{frame}[label=motivation-heuristics]{Motivation}
  %% \framesubtitle{Heuristics}    
  %% Knowing a variety has a difference term allows us to deduce useful
  %% properties of the algebras in that variety.

  Roughly speaking, having a difference term is slightly stronger than having
  a Taylor term and slightly weaker than having a Mal'tsev term.

  \[
  \text{ dt } \quad \Rightarrow \quad \text{ weak dt } \quad \Rightarrow \quad \text{ Taylor term}\]
  
  For finite $\bA$, $\bbV(\bA)$ has a weak dt iff
  $\bbV(\bA)$ has a Taylor term.
  %% \onslide<2>{{\color{gray}(locally finite?)}}
\end{frame}


%--------------------------------------------------------------------
\subsection{Main Problem: decide whether difference terms exist}

\begin{frame}[label=computational]{Computational Decision Problem}

  \begin{question}[1]
    \label{prob:2}
    Is there a polynomial-time algorithm that takes a finite
    idempotent algebra $\bA$ as input and decides whether 
    $\bA$ has a difference term operation?
  \end{question}

  \pause
  \begin{question}[2]
  \label{prob:1}
  Is there a polynomial-time algorithm that takes a finite
  idempotent algebra $\bA$ as input and decides whether the variety generated by
  $\bA$ has a difference term?
  \end{question}

\end{frame}

\begin{frame}[label=premature]{}

  \begin{center}
    ``I answered Question 2!''

    %% \animategraphics[loop,controls,width=5cm]{12}{84871861-}{0}{149}
    \animategraphics[loop,controls,width=5cm]{12}{./Vb68Anr/Vb68Anr-}{0}{39}

    \pause
    ~\phantom{XXXXXXXXXXX}...not really.
  \end{center}
\end{frame}
\begin{frame}[label=premature]{}

  \begin{center}
    \animategraphics[loop,controls,width=5cm]{12}{84871861-}{0}{149}
    %% \animategraphics[loop,controls,width=5cm]{12}{./Vb68Anr/Vb68Anr-}{0}{39}
    \pause
  \end{center}
\end{frame}

%%   \begin{frame}[label=champion]{Champion}
%% \end{frame}


%=========================================================================
\section{Local Difference Terms}

\subsection{Preliminaries}

\begin{frame}[label=local-diff-term-defs,shrink=5]{Local Difference Terms}
%% \framesubtitle{preliminaries 1}
% In~\cite{MR3239624},
% M.~Valeriote and R.~Willard, Idempotent {$n$}-permutable varieties, {\em Bull.
%   Lond. Math. Soc.} {\bf 46}(4)  (2014)  870--880.
Valeriote and Willard recently defined %% an \defn{$\bA$-triple for $\bp$}
%% to be a triple $(a,b,i)$ such that $a, b \in A$ and
%% $p_i(a,b,b) = p_{i+1}(a,a,b)$. They use this to define 
a ``local Hagemann-Mitschke sequence'' that they use for
efficiently deciding for a given $n$ whether an idempotent
variety is $n$-permutable. 

  \bigskip

  We devise a similar device we call a \emph{\alert{local difference term}}

  leading to a polynomial-time
  algorithm for deciding whether a given finite idempotent algebra
  has a difference term operation.

\end{frame}

\begin{frame}[label=local-diff-term-defs,shrink]{Notation}
  %% \framesubtitle{preliminaries 2}

  If $\theta$ is a tolerance or congruence of $\bA$, we abbreviate
  {\Large  \[
  \Com{\theta}= [\theta, \theta]
  \]}
\vfill
  \onslide<2->{%
    Similar to the standard notation
    for iterated commutator
      \[
        [\theta]^0 =  \theta, \quad
        [\theta]^1 =  [\theta, \theta],  \quad
        [\theta]^2 =  \bigl[[\theta, \theta],[\theta, \theta]\bigr],  \; \dots \;
        \]}
\end{frame}


\begin{frame}[label=local-diff-term-defs,shrink]{Local Difference Terms}
  %% \framesubtitle{definition}

  Let $\bA=\< A, \dots\>$ be an algebra.

  Fix $a, b \in A$ and $i \in \{0,1\}$.

  A \defn{local difference term for $(a,b,i)$} is a term $d(x,y,z)$ satisfying
  \begin{align}
    %% \text{ if $i=0$, then } & a \comm{\Cg^{\bA}(a,b)}{\Cg^{\bA}(a,b)} d(a,b,b); \label{eq:diff-triple}\\
    \text{ if $i=0$, } \; & \; a \Comr{\Cg(a,b)} d(a,b,b); \label{eq:diff-triple-1}\\
    \text{ if $i=1$, } \; & \hskip1cm d(a,a,b) = b. \label{eq:diff-triple-2}
  \end{align}

  \bigpause
  If $d$ satisfies~(\ref{eq:diff-triple-1}) and~(\ref{eq:diff-triple-2}) for all triples
  in some subset $S\subseteq A \times A \times \{0,1\}$, then $d(x,y,z)$ is a
  \defn{local difference term for $S$}.
\end{frame}


\subsection{First Result}

\begin{frame}[label=local-diff-term-res]{local $\leadsto$ global magic}%{First Result}
  %% \framesubtitle{first result}

  Let 
  $\sS = A \times A \times \{0,1\}$ and
  suppose every pair
  $((a_0, b_0, \chi_0), (a_1, b_1, \chi_1))$
  in $\sS^2$ has a local dt.

  \medskip

  That is, for each $((a_0, b_0, \chi_0), (a_1, b_1, \chi_1))$
  there is a $d(x,y,z)$ such that for each $i \in \{0,1\}$
  \begin{align*}
    a_i \Comr{\Cg(a_i,b_i)} d(a_i,b_i,b_i), & \;
  \text{ if $\chi_i=0$;} \\% \label{eq:d-trip-i1}\\
  d(a_i,a_i,b_i) =b_i, & \;
  \text{ if $\chi_i=1$.}%\label{eq:d-trip-i2} %\\\nonumber
  \end{align*}
  
  \medpause
  Then every subset $S\subseteq \sS$ has a local difference term.

  \vskip1mm
  That is, there is a single term $d$ that works 
  for all $(a_i, b_i, \chi_i) \in S$.
\end{frame}


\begin{frame}[label=local-diff-term-res]{}%{First Result}
  %% \framesubtitle{first result}


%% \subsection{Main Results}
\begin{theorem} %[\protect{{\small D. 2016}}]
  \label{thm:local-diff-terms}
  Let $\sV$ be an idempotent variety and
  $\bA \in \sV$. Define
  $\sS= A \times A \times \{0,1\}$
  and suppose that every pair
  $((a_0, b_0, \chi_0), (a_1, b_1, \chi_1)) \in \sS^2$
  has a local difference term.\\
  Then every subset $S \subseteq \sS$
  has a local difference term.
\end{theorem}

\end{frame}



\begin{frame}[label=local-diff-term-cor]{}%{Some Corollaries}
  %% \framesubtitle{corollaries}
  
\begin{corollary}
  \label{cor:loc-diff-term}
  A finite idempotent algebra $\bA$ has a difference term operation if and
  only if each pair $((a,b,i), (a',b',i')) \in (A\times A \times \{0,1\})^2$ has a local
  difference term.
\end{corollary}


\note{
  One direction is clear, since a difference term operation for $\bA$ is
  obviously a local difference term for the whole set 
  $A\times A \times \{0,1\}$.
  For the converse, suppose
  each pair in $(A\times A \times \{0,1\})^2$ has a local
  difference term. Then, by Theorem~\ref{thm:local-diff-terms},
  there is a single local difference term for the whole set $A\times A \times \{0,1\}$,
  and this is a difference term operation for $\bA$.  Indeed, if $d$ is a
  local difference term for $A\times A \times \{0,1\}$, then 
  for all $a, b \in A$, we have
  $a \Comr{\Cg(a,b)} d(a,b,b)$,
  since $d$ is a local difference term for $(a,b,0)$, and we have
  $d(a,a,b) = b$, since $d$ is also a local difference term for
  $(a,b,1)$.
}

\pause

\begin{corollary}
  \label{cor:algor-1}
  There is a polynomial-time algorithm that takes as input
  a finite idempotent algebra $\bA$ and decides whether
  %% the variety $\bbV(\bA)$ that it generates
  $\bA$ has a difference term operation.
\end{corollary}


\end{frame}

\begin{frame}[label=local-diff-term-res]{Theorem (proof sketch)}
  %% \framesubtitle{first result}

%% \subsection{Main Results}
%% \begin{theorem}[1] %[\protect{{\small D. 2016}}]
%%   \label{thm:local-diff-terms}
%%   Let $\sS= A \times A \times \{0,1\}$
%%   and suppose each
%%   $((a_0, b_0, \chi_0), (a_1, b_1, \chi_1)) \in \sS^2$
%%   has a local dt.
%%   Then every $S \subseteq \sS$
%%   has a local dt.
%% \end{theorem}
%% \begin{proof}[sketch]
  By induction on the size of $S$.

  In case $|S| = 2$ the claim holds by assumption.

  Assume every subset of $\sS$ of size $2\leq k \leq n$ has a local dt.

  Let $S = \{(a_0, b_0, \chi_0), (a_1, b_1, \chi_1), \dots, (a_{n}, b_{n},\chi_{n})\} \subseteq \sS$.
  
  We prove $S$ has a local difference term.

  \pause
  Wlog assume $\chi_0 = \chi_i$ for some $i>0$.

  %% Since $|S| \geq 3$ and $\chi_i \in \{0,1\}$ for all $i$, 
  %% $\exists i\neq j$ such that 
  %% Assume wlog $j=0$.

  Define $S' = S \setminus \{(a_0, b_0, \chi_0)\}$ and let $p$ be a local dt for $S'$.

  %% $|S'| < |S|$, so $S'$ has a local dt term, say, $p$.
\end{frame}

\begin{frame}[label=local-diff-term-res]{Proof (continued)}
  
  \underline{Case $\chi_0 = 0$}:
  
  Wlog assume $\chi_1 = \cdots =\chi_k = 1$
  and $\chi_{k+1}= \cdots = \chi_{n} = 0$.

  Define $T = \{(a_0, p(a_0, b_0, b_0), 0), (a_1, b_1, 1), \dots, (a_k, b_k, 1)\}$.

  Since $|T| < |S|$, $T$ has a local difference term, say, $t$.

  Define $d(x,y,z) = t(x, p(x,y,y), p(x,y,z))$.

  Then $d$ is a local difference term for $S$.

  \note{
    Since $\chi_0 =0$, we first verify that
    $(a_0, d(a_0,b_0,b_0))$ belongs to $\Com{\Cg(a_0,b_0)}$.
    Indeed,
    \begin{equation}
      \label{eq:100000}
      d(a_0,b_0,b_0) =
      t(a_0, p(a_0,b_0,b_0), p(a_0,b_0,b_0))\Comr{\Cg(a_0, p(a_0,b_0,b_0))} a_0.
    \end{equation}

    Note that the pair $(a_0, p(a_0,b_0,b_0))$ is equal to
    $(p(a_0,a_0,a_0), p(a_0,b_0,b_0))$ (by idempotence) and 
    belongs to $\Cg(a_0, b_0)$, so $\Cg(a_0, p(a_0,b_0,b_0))\leq \Cg(a_0,b_0)$.
    Therefore,
    %% so $\tau\leq \Cg(a_0,b_0)$. Therefore,
    by monotonicity of the commutator we have
    $\Com{\Cg(a_0, p(a_0,b_0,b_0))} \leq \Com{\Cg(a_0,b_0)}$.
    It follows from this and (\ref{eq:100000}) that
    %% $d(a_0,b_0,b_0)\comm{\Cg(a_0,b_0)}{\Cg(a_0,b_0)} a_0$,
    $d(a_0,b_0,b_0)\Comr{\Cg(a_0,b_0)} a_0$, as desired.

    For the indices $1\leq i \leq k$ we have $\chi_i =1$, so we prove
    $d(a_i,a_i,b_i) = b_i$ for such indices. Observe,
    \[
    d(a_i,a_i,b_i) =
    t(a_i, p(a_i,a_i,a_i), p(a_i,a_i,b_i)) % \label{eq:200000}\\
    =t(a_i, a_i, b_i) % \label{eq:200001}\\
    =b_i. % \label{eq:200002}
    \]
    The first equation holds by definition of $d$, the second
    because $p$ is an idempotent local difference term for
    $S'$, and the third because $t$ is a local difference term for $T$.

    The remaining triples in our original set $S$
    have indices satisfying $k<j\leq n$ and $\chi_j = 0$.
    Thus, for these triples we want
    $d(a_j,b_j,b_j)\Comr{\Cg(a_j,b_j)} a_j$.
    By definition,
    \begin{equation}
      \label{eq:450000}
      d(a_j,b_j,b_j) =t(a_j, p(a_j,b_j,b_j), p(a_j,b_j,b_j)).  
    \end{equation}
    Since $p$ is a local difference term for $S'$, %we have
    the pair $(p(a_j,b_j,b_j), a_j)$ belongs to $[\Cg(a_j,b_j), \Cg(a_j,b_j)]$.
    %% $(p(a_j,b_j,b_j), a_j)\in [\Cg(a_j,b_j), \Cg(a_j,b_j)]$.
    This and 
    (\ref{eq:450000}) imply
    that 
    $(d(a_j, b_j,b_j), t(a_j,a_j,a_j))$
    belongs to
    $\Com{\Cg(a_j,b_j)}$.
    Finally, by idempotence of $t$ we have
    $d(a_j,b_j,b_j)\Comr{\Cg(a_j,b_j)} a_j$,
    as desired.
  }
  
\end{frame}
\begin{frame}[label=local-diff-term-res]{Proof (continued)}
  
  \underline{Case $\chi_0 = 1$}:
  
  Wlog assume
  $\chi_1 = \cdots =\chi_k = 0$
  and $\chi_{k+1} = \cdots = \chi_{n} = 1$.

  Define $T = \{(p(a_0, a_0, b_0), b_0, 1),
  (a_1, b_1, 0),  \dots, (a_k, b_k, 0)\}$

  Let $t$ be a local difference term for $T$.

  %% \[d(x,y,z) = t(p(x,y,z), p(y,y,z), z).\] 
  Define $d(x,y,z) = t(p(x,y,z), p(y,y,z), z)$. 

  Then $d$ is a local difference term for $S$.

  \note{Since $\chi_0 =1$, want $d(a_0,a_0,b_0) = b_0$.

    By definition of $d$,
    $d(a_0,a_0,b_0) = t(p(a_0,a_0,b_0), p(a_0,a_0,b_0), b_0) =b_0$.

    The last equality holds since $t$ is a local difference term for $T$, thus,
    for $(p(a_0, a_0, b_0), b_0, 1)$.

    If $1\leq i \leq k$, then $\chi_i =0$, so for these indices we prove
    $(a_i, d(a_i,b_i,b_i))$ belongs to $\Com{\Cg(a_i,b_i)}$.

    By definition of $d$ and idempotence of $p$,
    \begin{equation}
      \label{eq:40000}
      d(a_i,b_i,b_i) =
      t(p(a_i,b_i,b_i), p(b_i,b_i,b_i), b_i)=
      t(p(a_i,b_i,b_i), b_i, b_i).
    \end{equation}

    Since $p$ is a local difference term for $S'$,
    \begin{equation}
      \label{eq:50000}
      t(p(a_i,b_i,b_i), b_i, b_i) \Comr{\Cg(a_i,b_i)}  t(a_i, b_i, b_i).
    \end{equation}

    Since $t$ is a local difference term for $T$, hence for $(a_i, b_i, b_i)$,
    \[
    t(a_i, b_i, b_i) \Comr{\Cg(a_i,b_i)} a_i.
    \]
    This plus (\ref{eq:40000}) and (\ref{eq:50000}) yields
    $d(a_i,b_i,b_i) \Comr{\Cg(a_i,b_i)} a_i$, as desired.

    The remaining elements of $S$ have indices $j : k<j\leq n$ and $\chi_j = 1$.

    For these we want $d(a_j,a_j,b_j) = b_j$.

    Since $p$ is a local difference term for $S'$, we have
    $p(a_j,a_j,b_j) = b_j$, so by idempotence of $t$,
    \[ d(a_j,a_j,b_j) =  t(p(a_j,a_j,b_j), p(a_j,a_j,b_j), b_j)=  t(b_j, b_j, b_j) =b_j.\]
}

\end{frame}

%% \newcommand\mytab{\phantom{XXXX}}

\subsection{Algorithm}
\label{sec:algor-1}

\begin{frame}[label=algorithm]{DTO Algorithm}

  {\bf Input:} A finite idempotent algebra $\bA$

  {\bf Output:} ``yes'' iff $\bA$ has a difference term operation

  \pause
  By the theorem it suffices to decide whether each pair
  $((a,b,i), (a',b',i'))$ %% \in (A\times A \times \{0,1\})^2$ 
  has its own local difference term.

  \pause
  %% For each $((a,b,i), (a',b',i'))$ in $(A\times A \times \{0,1\})^2$:
  If $i = i' = 0$, the first projection is a local dt.

  If $i = i' = 1$, the third projection is a local dt.

  If $i = 0$, $i'=1$,  then %% $((a,b,i), (a',b',i')) = ((a,b,0), (a',b',1))$, then
  %% $i = 1$ and $i'=0$. Since these are completely symmetric, we only handle the first case.
  $t$ is local dt for $((a,b,0), (a',b',1))$ iff
  \[
  a\Comr{\Cg(a,b)} t^{\bA}(a,b,b) \; \text{ and } \;
  t^{\bA}(a',a',b') = b'
  \]
  \hfill {\Large $\rightsquigarrow$}
\end{frame}
\begin{frame}[label=algorithm]{DTO Algorithm (cont)}
  Since
    $t^{\bA\times \bA}((a,a'), (b,a'), (b,b')) =
    (t^{\bA}(a,b,b),t^{\bA}(a',a',b'))$,

  $t$ is a local dt for $((a,b,0), (a',b',1))$ iff
  \[
  t^{\bA\times \bA}((a,a'), (b,a'), (b,b'))\in \bigl(a/\Com{\Cg(a,b)}\bigr) \times \{b'\}.
  \]
  %% where $\delta = \Com{\Cg(a,b)}$ and $a/\delta$ denotes the
  %% $\delta$-class containing $a$.

  \note{By idempotence $\bigl(a/\Com{\Cg(a,b)}\bigr) \times \{b'\}$ is a subalgebra of $\bA \times \bA$.}

  So $((a,b,0), (a',b',1))$ has a local dt iff the intersection
  \[\Sg^{\bA^2}\{(a,a'), (b,a'), (b,b')\} \bigcap
  \bigl(a/\Com{\Cg(a,b)}\bigr) \times \{b'\}\]
  is nontrivial.
\end{frame}

\begin{frame}[label=algorithm]{DTO Algorithm (cont)}
  For each
  $((a,a'), (b,a'), (b,b'))$ in $(A\times A)^3$:

  - compute $\delta = \Com{\Cg(a,b)}$

  - compute $S=\Sg^{\bA^2}\{(a,a'), (b,a'), (b,b')\}$

  - test whether $S \cap (a/\delta \times \{b'\})$ is empty.

  If at some point we encounter an empty intersection, halt---$\bA$ has no dt operation.
  Otherwise $\bA$ has a dt operation.
  \note{
        Most of the operations carried out by this algorithm are well known to be
    polynomial-time.  For example, that the running time of subalgebra generation is
    polynomial has been known for a long time (see~\cite{MR0455543}).
    The time complexity of congruence generation is also known to be polynomial
    (see~\cite{MR2470585}).  The only operation whose tractability might be 
    called into question is the commutator, but we have a straight-forward 
    algorithm for computing it that we describe in detail in 
    Appendix Section~\ref{sec:interlude:-an-easy}.
    }
\end{frame}



%=========================================================================
\section{Generalizations and Extensions}

%% \input{inputs/mix-loc-diff-terms.tex}

%%% NEW SECTION
\subsection{Mixed local difference terms}
\label{sec:mixed-local-diff}

\begin{frame}[label=extensions]{Extending the local term idea}
\note{Proofs of these results do not depend on considering only a single algebra.  }

Let $\sV$ be a variety.
Let $\bA_0$ and  $\bA_1$ be algebras in $\sV$.

%% An element of $\bA_0 + \bA_1$ is $\<a, i\>$,
%% where $i\in \{0,1\}$ and $a \in A_i$.

%% $\coprod_{i=0}^1 (\bA_i\times \bA_i)$ has elements
$A_0^2 + A_1^2$ has elements
$\<(a,b), i\>$ where $i\in \{0,1\}$ and $(a,b) \in A_i^2$.

$(A_0^2 + A_1^2) \times \{0,1\}$
has elements $(\<(a,b), i\>, \chi)$, where
\[
i\in \{0,1\} \qquad  (a,b) \in A_i^2 \qquad \chi\in \{0,1\}.
\]

Fix $(\<(a, b),i\>, \chi)$ and $(\<(a', b'),i'\>, \chi')$ in
$(A_0^2 + A_1^2) \times \{0,1\}$.

A (mixed) \defn{local difference term} for this pair is a term $d$ satisfying
\begin{align*}
  \text{ if $\chi=0$,  }\quad & a \Comr{\Cg^{\bA_i}(a,b)} d^{\bA_i}(a,b,b);\\
  %% \label{eq:mixed-diff-triple}\\
  \text{ if $\chi=1$,  }\quad &d^{\bA_i}(a,a,b) = b,
\end{align*}
and similarly for $a'$, $b'$, $i'$, $\chi'$.
\end{frame}


\begin{frame}[label=extensions]{Extensions (continued)}

  Let $S$ be a sequence of triples drawn from the set
  \[
  \sU = (A_0^2 + A_1^2) \times \{0,1\}.
  \]

  Call $d$ a \defin{local difference term for $S$} iff $d$ is a local dt for all triples in $S$.

  %% We may use $\sU$ to denote the set $\sU(A_0, A_1)$ when the context renders the
  %% universes involved obvious or immaterial.

  Suppose all pairs in $\sU$ have local difference terms.
  Then, for every $n$
  %% and every sequence $S\in \sU^n$, there is a term $d$ that is a mixed local
  %% difference term for $S$.
  every sequence $S\in \sU^n$ has a mixed local dt.

  That is, there is a single term that works
  for all $(\<(a, b), i\>,\chi)$ in $S$.
\end{frame}

\begin{frame}[label=extensions]{~}

  %% From now on we drop the ``mixed'' qualifier since
  %% it is inconsequential.

  \begin{theorem} %[\protect{cf.~\cite[Theorem 2.2]{MR3239624}}]
  \label{thm:mixed-local-diff-terms}
  $\bA_0$ and   $\bA_1$ be finite algebras in an idempotent variety $\sV$.
  Define $\sU  = (A_0^2 + A_1^2)\times \{0,1\}$
  and suppose every 
  $((\<(a, b), i\>, \chi), (\<(a', b'), i'\>\chi')) \in \sU^2$
  has a local difference term.
  Then $\forall n$ every $S \in \sU^n$
  has a local difference term.
  \end{theorem}

  \pause

  \begin{corollary}
  \label{cor:mix-loc-diff-term}
  Let $\bA_0 = \<A_0, \dots\>$ and   $\bA_1 = \<A_1, \dots\>$ be 
  finite idempotent algebras.
  %% Define
  %% $\sU  = (A_0^2 + A_1^2)\times \{0,1\}$
  %% and 
  Suppose every pair
  $((\<(a, b), i\>, \chi), (\<(a', b'), i'\>\chi'))$
  in $(A_0^2 + A_1^2)\times \{0,1\}$
  has a local dt. Then, there is a term $d$ that interprets as a
  difference term operation for both $\bA_0$ and $\bA_1$.
  \end{corollary}
\end{frame}

\begin{frame}[label=extensions]{Extensions (continued)}
  Let $\sV$ be a variety, let $\bA = \<A, \dots\> \in \sV$. 

  For a fixed $i\in \{0,1\}$, $d$ is a \defin{local difference term for $(A, i)$} iff
  $d$ is a local difference term for every triple
  $(a,b,i) \in A \times A \times \{i\}$.
  %% That is, for all $a, b \in A$,
  %% \begin{align}
  %%   \text{ if $i=0$, then } & \, a \Comr{\Cg^{\bA}(a,b)} d^{\bA}(a,b,b);
  %%   \label{eq:global-diff-triple}\\
  %%   \text{ if $i=1$, then } & \,
  %%   d^{\bA}(a,a,b) = b. 
  %% \end{align}

  \pause
  Let $\scA$ be a collection of algebras in $\sV$, and
  $\scS(\scA)$ all pairs $(A, i)$,
  where $A$ is a universe from $\scA$ and $i\in \{0,1\}$. That is
  \[
  \scS(\scA) = \{(A, i) \mid \<A, \dots\> \in \scA \text{ and } i \in \{0,1\}\}.
  \]
  \pause
  Given a sequence
  $S = ((A_0, \chi_0), (A_1, \chi_1), \dots,
  (A_{n-1},\chi_{n-1})) \in \scS(\scA)^n$,
  a term $d$ is called a \defin{\glocal difference term for $S$}
  if it is a \glocal difference term for every pair $(A_i, \chi_i)$ in $S$.
  
%%   In addition to these definitions, in the proof of the next theorem we use
%%   $|S|$ to denote the \emph{length of the sequence $S$}
%% (or, in case $S$ is a set, then $|S|$ denotes the cardinality of $S$, as usual).
\end{frame}


\begin{frame}[label=extensions]{~}

\begin{theorem}
  \label{thm:glob-loc-diff-terms}
  Let $\scA$ be a collection of finite idempotent
  algebras in $\sV$ and let
  $S= ((A_0, \chi_0), (A_1, \chi_1), \dots, (A_{n-1}, \chi_{n-1}))\in \scS(\scA)^n$,
  for some $n\geq 2$.
  Then there is a term that is a \glocal difference term for $S$
  if and only if each 2-element subsequence $((A_i,\chi_i), (A_j,\chi_j))$ of $S$
  has a \glocal difference term.
\end{theorem}
%% We relegate the proof of Theorem~\ref{thm:glob-loc-diff-terms} 
%% to the appendix (see Section~\ref{sec:proof-thm:glob}), since the argument 
%% is nearly identical to the one used to prove Theorem~\ref{thm:local-diff-terms}. 
\pause

\begin{corollary}
  \label{cor:glob-loc-diff-term}
  Let $\scA$ be a collection of finite idempotent
  algebras in $\sV$. %% that is closed under the taking of subalgebras.
  Then there is a term $d$ that interprets as a difference term operation
  for every algebra in $\scA$
  if and only if each pair $((A,i), (B,j)) \in \scS(\scA)^2$ has a \glocal
  difference term.
\end{corollary}

\end{frame}
%% Since the proof of Corollary~\ref{cor:glob-loc-diff-term}
%% is easy and similar to the proof
%% of Corollary~\ref{cor:loc-diff-term}, we consign it to 
%% appendix Section~\ref{sec:proof-cor:glob}.

%% We now pause to fix some more notation.
%% If $\alpha \in \Con(\bA)$ and $\beta \in \Con(\bB)$, then we let
%% $\alpha \mytimes \beta$ denote the set of pairs $((a,b),(a',b'))\in (A\times B)^2$ satisfying
%% $a \mathrel{\alpha} a'$ and $b \mathrel{\beta} b'$.  The relation 
%% $\alpha \mytimes \beta$ is clearly a congruence of $\bA \times \bB$.

% \pagebreak[1]
\begin{frame}[label=extensions]{Extensions (continued)}

\begin{lemma}
  \label{lem:products}
  If $\bA$ and $\bB$ are finite, idempotent algebras of same type
  and if $d^{\bA \times \bB}$ is a difference term operation for $\bA\times \bB$,
  then $d^{\bA}$ (resp., $d^{\bB}$) is a difference term operation for 
  $\bA$  (resp., $\bB$).
\end{lemma}

\pause
\begin{question}
  Is the converse true? 
  If $d^{\bA}$ and $d^{\bB}$ are dt operations for 
  $\bA$ and $\bB$ (resp.), does it follow that $d^{\bA \times \bB}$
  is a dt operation for $\bA \times \bB$?
\end{question}
\end{frame}


\section{Progress on Question 2}

%% ====== BEGIN: F(2) stuff ==============================================================
\begin{frame}[label=f2lem]{}

  Some observations due to Kearnes (1998)...

\hfill  {\small ...unless they're wrong; then they're due to me.}
  \begin{lemma}
    \label{lem:equiv-cond-exist-1}
    Let $\bA$ be an algebra, $t(x,y,z)$ a ternary term.
    Assume $\bF = \bF_{\bbV(\bA)}(2)$ finite. 
    Consider the following statements:
    \begin{enumerate}[(A)]
    \item \label{item:6} $t^{\bA}$ is not a dt operation for $\bA$.
    \item \label{item:7} $\exists$ a 2-generated $\bB \leq \bA$
      such that $t^{\bB}$ is not a dt op for $\bB$.
    \item \label{item:8} $t^{\bF}$ is not a dt operation for $\bF$.
    \end{enumerate}
    Then (\ref{item:6}) $\Rightarrow$ (\ref{item:7})  $\Rightarrow$ (\ref{item:8}).
  \end{lemma}
  \note{
    {\bf Proof sketch}
  
    (\ref{item:6}) $\Rightarrow $ (\ref{item:7}):
    Suppose  $t^{\bA}$ fails to be a difference term operation for $\bA$ and let $a, b \in
    A$ witness this failure. Then either
    \begin{enumerate}
    \item[1.]\label{item:9} $d^{\bA}(a,a,b) \neq b$, or
    \item[2.]\label{item:10} $(d^{\bA}(a,b,b), a) \notin \com{\Cg^{\bA} (a, b)}$.
    \end{enumerate}

    \pause 
    Let $\bB = \Sg^{\bA} (a, b)$.  

    In case 1,
    $d^{\bB}(a,a,b) = d^{\bA}(a,a,b) \neq b$, so $d^{\bB}(x,y,z)$ is not a difference
    term operation for $\bB$.
  
    \pause
    In case 2,
    $(d^{\bB}(a,b,b), a) = (d^{\bA}(a,b,b), a)$ is not in $\com{\Cg^{\bA} (a, b)}$.
    So, assuming 
    \[\com{\Cg^{\bB} (a, b)} \subseteq \com{\Cg^{\bA} (a, b)},\]
    we have $(d^{\bB}(a,b,b), a) \notin \com{\Cg^{\bB} (a, b)}$, so
    $d^{\bB}(x,y,z)$ is not a difference term for $\bB$.

    Inclusion~(\ref{eq:6}) holds because 
    $\CC{\beta}{\beta}{\delta}$ holds when
    $\beta := \Cg^{\bB} (a, b)$ and
    $\delta:=\com{\Cg^{\bA} (a, b)} \cap B^2$.

    Since there is a homomorphism from $\bF$ to $\bB$,
    $d^{\bF}(x,y,z)$ is not a difference term operation for $\bF$.
  }
\end{frame}

\begin{frame}[label=f2lem,shrink]{~}
  
\begin{corollary}
  \label{thm:F}
  Let $\sV$ be a variety. Assume $\bF = \bF_{\sV}(2)$ finite.
  Then the following are equivalent:
  \begin{enumerate}[(i)]
  \item \label{item:1}
    $\sV$ has a difference term;
  \item \label{item:2}
    $\sansH \sansS \sansP (\bF)$ has a difference term;
  \item \label{item:3}
    $\bF$ has a difference term operation.
  \end{enumerate}
\end{corollary}

\pause
The implications
  (\ref{item:1}) $\Rightarrow$  (\ref{item:2}) $\Rightarrow$  (\ref{item:3}) are
  obvious. 

  \pause 
  (\ref{item:3}) $\Rightarrow$  (\ref{item:1}) is easy to prove by contraposition:

  Suppose $\sV$ has no dt and let $d(x,y,z)$ be a ternary term.

  Let $\bA\in \sV$ be such that $d^{\bA}(x,y,z)$ is not a dt operation. 

  By previous lemma % Lemma~\ref{lem:equiv-cond-exist-1},
  $d^{\bF}(x,y,z)$ is not a dt operation for $\bF$.
  %% Since $d(x,y,z)$ is arbitrary, it follows that
  %% $\bF$ has no difference term operation whatsoever.
  %% , as we set out to prove.
\end{frame}

\begin{frame}[label=goal,shrink]{Goal}
  
  \begin{question}[2]
  Is there a polynomial-time algorithm that takes as input
  any finite idempotent algebra $\bA$ and decides whether
  $\bbV(\bA)$ has a difference term?
  \end{question}

  Let $\sV = \bbV(\bA)$ and $\bF = \bF_{\sV}(x,y)$.

  $\sV$ has a difference term iff
  $\bF$ has a difference term operation.
  
  $\bF$ is a subdirect product of
  $\bA_0 \times \bA_1 \times \cdots \times \bA_{n-1}$, where $n\leq |A|^2$ and
  each $\bA_i$ is a 2-generated subalgebra of $\bA$.

  Let $\scA = \{A_0, A_1, \dots, A_{n-1}\}$ and let $\scS(\scA)$ denote 
  all pairs $(A, i)$ such that $\bA = \<A, \dots\> \in \scA$ and $i\in \{0,1\}$.

  {\bf Claim:} We can check in polynomial time (in $|A|$)
  whether the product
  $\bA_0 \times \bA_1 \times \cdots \times \bA_{n-1}$ has a difference term operation.

\end{frame}

\begin{frame}[label=goal,shrink]{Progress on Question 2}

  %Corollary~\ref{cor:glob-loc-diff-term} and Lemma~\ref{lem:products-conv},
  It suffices to check each of the $n^2$ pairs in $\scS(\scA)^2$ has a \glocal
  dt.

  Fix $((A_i, \chi_i), (A_j, \chi_j)) \in  \scS(\scA)^2$.
  Let $\sU  = (A_i^2 + A_j^2)\times \{0,1\}$.

  We prove every sequence $S \in \sU^n$
  has a local dt by checking that every pair
  $\bigl( (\<(a, b), i\>, \chi), (\<(a', b'), i'\>, \chi')\bigr) \in \sU^2$
  has a local dt.

  To check whether
  $\bigl( (\<(a, b), i\>, \chi), (\<(a', b'), i'\>, \chi')\bigr)$
  has a local dt requires at most
  a polynomial in $|A_i||A_j|\leq |A|^2$ many steps.

  There are $4|A_i|^2|A_j|^2 \leq 4|A|^4$ pairs in $\sU^2$, 
  so it takes a polynomial %% (in $|A|$)
  number of steps to test whether $((A_i, \chi_i), (A_j, \chi_j))$ has a \glocal dt.

  There are $n^2 \leq |A|^4$ such pairs to test, so the number of steps
  required to test if
  $\bA_0 \times \bA_1 \times \cdots \times \bA_{n-1}$ has a dt
  operation is bounded by a constant times a power of $|A|$.
\end{frame}


\begin{frame}[label=pau]{}
\begin{center}
\bigskip\bigskip
\includegraphics[scale=.4]{gob2}
\end{center}
\end{frame}

\begin{frame}[label=pau]{}
\begin{center}

Let's Quit for the Day!

\bigskip\bigskip
\includegraphics[scale=.4]{drinks}
\end{center}
\end{frame}
%% ====== END: F(2) stuff ==============================================================

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%





%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
